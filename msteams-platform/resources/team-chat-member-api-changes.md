---
title: チームおよびチャット メンバーのボット API の変更
author: ojasvichoudhary
description: チームとチャットのメンバーを取得するために使用されるボット API に対する今後の変更と進行中の変更について説明します。
keywords: bot framework apis チーム メンバー名簿
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: d55cbcdfea5e374c151c3eec82c52ac7f434c153
ms.sourcegitcommit: 49d1ecda14042bf3f368b14c1971618fe979b914
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2021
ms.locfileid: "51034692"
---
# <a name="changes-to-teams-bot-apis-for-fetching-team-and-chat-members"></a><span data-ttu-id="0084e-104">チームメンバーとチャット メンバーをフェッチする Teams ボット API の変更点</span><span class="sxs-lookup"><span data-stu-id="0084e-104">Changes to Teams bot APIs for fetching team and chat members</span></span>

>[!NOTE]
> <span data-ttu-id="0084e-105">廃止プロセスと API の使用を `TeamsInfo.getMembers` `TeamsInfo.GetMembersAsync` 開始しました。</span><span class="sxs-lookup"><span data-stu-id="0084e-105">We've started with the deprecation process for `TeamsInfo.getMembers` and `TeamsInfo.GetMembersAsync` APIs.</span></span> <span data-ttu-id="0084e-106">最初は、1 分間に 5 回の要求に大きく調整され、チームごとに最大 10K のメンバーが返されます。</span><span class="sxs-lookup"><span data-stu-id="0084e-106">Initially, they will be heavily throttled to 5 requests per minute and return a maximum of 10K members per team.</span></span> <span data-ttu-id="0084e-107">これにより、チーム のサイズが大きくなって完全な名簿が返されません。</span><span class="sxs-lookup"><span data-stu-id="0084e-107">This will result in the full roster not being returned as team size increases.</span></span> 
> 
> <span data-ttu-id="0084e-108">**Bot Framework SDK のバージョン 4.10** 以上に更新し、ページ分割された API エンドポイントまたは単一ユーザー `TeamsInfo.GetMemberAsync` API に切り替える必要があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-108">**You must update to version 4.10 or higher of the Bot Framework SDK** and switch to the paginated API endpoints, or the `TeamsInfo.GetMemberAsync` single user API.</span></span> <span data-ttu-id="0084e-109">これは、古い SDK がメンバーの間にこれらの API を呼び出すので、これらの API を直接使用していない場合でも、ボットにも [適用されますAdded](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added) イベント。</span><span class="sxs-lookup"><span data-stu-id="0084e-109">This also applies to your bot even if you're not directly using these APIs, as older SDKs call these APIs during [membersAdded](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added) events.</span></span> <span data-ttu-id="0084e-110">今後の変更の一覧を表示するには、「API の変更」 [を参照してください](team-chat-member-api-changes.md#api-changes)。</span><span class="sxs-lookup"><span data-stu-id="0084e-110">To view the list of upcoming changes, see [API changes](team-chat-member-api-changes.md#api-changes).</span></span> 

<span data-ttu-id="0084e-111">現在、チャットまたはチームの 1 つ以上のメンバーの情報を取得するボット開発者は、Microsoft Teams ボット API (C# 用) または `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` (TypeScript/Node.js) API [(](../bots/how-to/get-teams-context.md#fetching-the-roster-or-user-profile)ここに記載) を使用しています。</span><span class="sxs-lookup"><span data-stu-id="0084e-111">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` (for C#) or `TeamsInfo.getMembers` (for TypeScript/Node.js) APIs [(documented here)](../bots/how-to/get-teams-context.md#fetching-the-roster-or-user-profile).</span></span> <span data-ttu-id="0084e-112">これらの API には、今日いくつかの欠点があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-112">These APIs have several shortcomings today:</span></span>

* <span data-ttu-id="0084e-113">**大規模なチームでは、パフォーマンスが低下し、タイムアウトが発生する可能性が高いです。**</span><span class="sxs-lookup"><span data-stu-id="0084e-113">**For large teams, performance is poor and timeouts are more likely.**</span></span> <span data-ttu-id="0084e-114">Microsoft Teams が 2017 年初めにリリースされた後、チームの最大サイズは大幅に増加しています。</span><span class="sxs-lookup"><span data-stu-id="0084e-114">The maximum team size has grown considerably since Microsoft Teams was released in early 2017.</span></span> <span data-ttu-id="0084e-115">メンバー `GetMembersAsync` / リスト全体を返すので、API 呼び出しが大規模なチームに戻るのに時間がかかるので、呼び出しがタイム アウトし、もう一度やり直す必要があります `getMembers` 。</span><span class="sxs-lookup"><span data-stu-id="0084e-115">Since `GetMembersAsync`/`getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it’s not uncommon for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="0084e-116">**1 人のユーザーのプロファイルの詳細を取得する作業は面倒です。**</span><span class="sxs-lookup"><span data-stu-id="0084e-116">**Getting profile details for a single user is cumbersome.**</span></span> <span data-ttu-id="0084e-117">1 人のユーザーのプロファイル情報を取得するには、メンバー リスト全体を取得し、必要なユーザーを検索する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-117">To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="0084e-118">True、 Bot Framework SDK には、より簡単なヘルパー関数がありますが、カバーの下では効率的ではありません。</span><span class="sxs-lookup"><span data-stu-id="0084e-118">True, there’s a helper function in the Bot Framework SDK to make it simpler, but under the covers it’s not efficient.</span></span>

<span data-ttu-id="0084e-119">これとは別に、組織全体のチームの導入により、これらの API を Office 365 のプライバシー制御に合わせ、大規模なチームで使用されるボットは基本的なプロファイル情報を取得できます。これは Microsoft Graph のアクセス許可に似ています。 `User.ReadBasic.All`</span><span class="sxs-lookup"><span data-stu-id="0084e-119">Separately, with the introduction of org-wide teams, we realized it was time to better align these APIs with Office 365 privacy controls: bots used in large teams are able to retrieve basic profile information, which is similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="0084e-120">テナント管理者は、テナントで使用できるアプリとボットを大きな制御を持っていますが、これらの設定は Microsoft Graph を管理するアプリとは異なります。</span><span class="sxs-lookup"><span data-stu-id="0084e-120">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different than the ones governing Microsoft Graph.</span></span>

<span data-ttu-id="0084e-121">今日、これらの API によって返される処理の JSON 表現の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="0084e-121">Here’s a sample JSON representation of what’s returned by these APIs today.</span></span> <span data-ttu-id="0084e-122">以下のフィールドの一部を参照します。</span><span class="sxs-lookup"><span data-stu-id="0084e-122">I’ll refer to some of the fields below.</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="0084e-123">API の変更</span><span class="sxs-lookup"><span data-stu-id="0084e-123">API Changes</span></span>
<span data-ttu-id="0084e-124">今後の API の変更点を次に示します。</span><span class="sxs-lookup"><span data-stu-id="0084e-124">Here are the upcoming API changes:</span></span>

* <span data-ttu-id="0084e-125">チャット/チームのメンバーのプロファイル情報を取得するための新しい [`TeamsInfo.GetPagedMembersAsync`](../bots/how-to/get-teams-context.md#fetching-the-roster-or-user-profile) API が作成されました。</span><span class="sxs-lookup"><span data-stu-id="0084e-125">We've created a new API [`TeamsInfo.GetPagedMembersAsync`](../bots/how-to/get-teams-context.md#fetching-the-roster-or-user-profile) for retrieving profile information for members of a chat/team.</span></span> <span data-ttu-id="0084e-126">この API は、ボット フレームワーク 4.10 SDK で利用できます。</span><span class="sxs-lookup"><span data-stu-id="0084e-126">This API is now available with the Bot Framework 4.10 SDK.</span></span> <span data-ttu-id="0084e-127">他のすべてのバージョンでの開発では、このメソッドを使用 [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) します。</span><span class="sxs-lookup"><span data-stu-id="0084e-127">For development in all other versions use the [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) method.</span></span> 
  > [!NOTE]
  > <span data-ttu-id="0084e-128">v3 または v4 では、ベスト アクションは、最新のポイント リリースにアップグレードする方法です。</span><span class="sxs-lookup"><span data-stu-id="0084e-128">In either v3 or v4, the best action is to upgrade to the latest point release.</span></span> 
* <span data-ttu-id="0084e-129">1 人のユーザーのプロファイル情報を取得するための新しい API [`TeamsInfo.GetMemberAsync`](../bots/how-to/get-teams-context.md#get-single-member-details) が作成されました。</span><span class="sxs-lookup"><span data-stu-id="0084e-129">We've created a new API [`TeamsInfo.GetMemberAsync`](../bots/how-to/get-teams-context.md#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="0084e-130">チーム/チャットの ID と[UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (上記を参照 `userPrincipalName` )、Azure Active Directory オブジェクト ID (、上記参照)、または Teams ユーザー ID (上記を参照 `objectId`  `id` )をパラメーターとして受け取り、そのユーザーのプロファイル情報を返します。</span><span class="sxs-lookup"><span data-stu-id="0084e-130">It takes the ID of the team/chat and a [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (`userPrincipalName`, *see above*), Azure Active Directory Object ID (`objectId`, *see above*), or the Teams user ID (`id`, *see above*) as parameters and returns the profile information for that user.</span></span> 
  > [!NOTE]
  > <span data-ttu-id="0084e-131">ボット フレームワーク メッセージのオブジェクトで呼び出された名前に合 `objectId` `aadObjectId` `Activity` わせて変更しています。</span><span class="sxs-lookup"><span data-stu-id="0084e-131">We're changing `objectId` to `aadObjectId` to match what it's called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="0084e-132">新しい API は、ボット フレームワーク SDK のバージョン 4.10 で使用できます。</span><span class="sxs-lookup"><span data-stu-id="0084e-132">The new API is available with version 4.10 of the Bot Framework SDK.</span></span> <span data-ttu-id="0084e-133">Teams SDK 拡張機能 Bot Framework 3.x でもすぐに利用できます。一方 [、REST](../bots/how-to/get-teams-context.md?get-single-member-details) エンドポイントを使用できます。</span><span class="sxs-lookup"><span data-stu-id="0084e-133">It will soon be available in the Teams SDK extension Bot Framework 3.x as well; meanwhile you can use the [REST](../bots/how-to/get-teams-context.md?get-single-member-details) endpoint.</span></span>
* <span data-ttu-id="0084e-134">`TeamsInfo.GetMembersAsync` (C#) および `TeamsInfo.getMembers` (TypeScript/Node.js) は正式に廃止され、2021 年後半に動作を停止します。</span><span class="sxs-lookup"><span data-stu-id="0084e-134">`TeamsInfo.GetMembersAsync` (C#) and `TeamsInfo.getMembers` (TypeScript/Node.js) is formally deprecated and will stop working in late 2021.</span></span> <span data-ttu-id="0084e-135">ページ API を使用するボットを更新してください。</span><span class="sxs-lookup"><span data-stu-id="0084e-135">Please update your bots to use the paged APIs.</span></span> <span data-ttu-id="0084e-136">(これは、これらの API が使用する [基になる REST API にも適用されます](../bots/how-to/get-teams-context.md)。)</span><span class="sxs-lookup"><span data-stu-id="0084e-136">(This also applies to the [underlying REST API these APIs use](../bots/how-to/get-teams-context.md).)</span></span>
* <span data-ttu-id="0084e-137">2021 年後半には、ボットはチャット/チームのメンバーのプロパティを事前に取得する機能を使用し、Microsoft Graph を使用して取得する `userPrincipalName` `email` 必要があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-137">By late 2021, bots will not be able to proactively retrieve the `userPrincipalName` or `email` properties for members of a chat/team and will need to use Microsoft Graph to retrieve them.</span></span> <span data-ttu-id="0084e-138">具体的には、 `userPrincipalName` プロパティ `email` は 2021 年後半から新しい API から `GetConversationPagedMembers` 返されません。</span><span class="sxs-lookup"><span data-stu-id="0084e-138">Specifically, `userPrincipalName` and `email` properties won't be returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="0084e-139">ボットは、この情報を取得するためにアクセス トークンと Microsoft Graph を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-139">Bots will have to use Microsoft Graph with an access token to retrieve this information.</span></span> <span data-ttu-id="0084e-140">これは明らかに大きな変更です。ボットがアクセス トークンを取得しやすくする必要があります。また、エンドユーザーの同意プロセスを合理化して簡素化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0084e-140">This is obviously a major change: We must make it easier for bots to get an access token, and we must streamline and simplify the end-user consent process.</span></span>

## <a name="feedback-and-more-information"></a><span data-ttu-id="0084e-141">フィードバックと詳細</span><span class="sxs-lookup"><span data-stu-id="0084e-141">Feedback and More Information</span></span>
<span data-ttu-id="0084e-142">これらの変更に関する最新の情報を提供するために、このページを使用します。</span><span class="sxs-lookup"><span data-stu-id="0084e-142">We'll use this page for providing up to date information on these changes.</span></span> <span data-ttu-id="0084e-143">ご質問がある場合は、以下の 「フィードバック」セクション>「このページでフィードバックを送信 **する」を** 使用してください。</span><span class="sxs-lookup"><span data-stu-id="0084e-143">If you have questions, use the "Send feedback > on this page" in the **Feedback** section below.</span></span> 
