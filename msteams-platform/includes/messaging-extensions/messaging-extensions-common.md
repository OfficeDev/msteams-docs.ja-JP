## <a name="add-a-messaging-extension-to-your-app"></a>アプリにメッセージング拡張機能を追加する

メッセージング拡張機能は、ユーザーの要求をリッスンし、カードなどの構造化データで応答するクラウドホスト型サービス [です](~/task-modules-and-cards/what-are-cards.md)。 ボット フレームワーク オブジェクトを介してサービスMicrosoft Teamsサービスと統合 `Activity` します。 ボット ビルダー SDK の .NET Node.js拡張機能は、アプリにメッセージング拡張機能を追加するのに役立ちます。

![メッセージング拡張機能のメッセージ フローの図](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>ボット フレームワークに登録する

まだ登録していない場合は、最初にボットを登録する必要Microsoft Bot Framework。 ボットの Microsoft アプリ ID とコールバック エンドポイントは、そこで定義されている通り、メッセージング拡張機能でユーザー要求の受信と応答に使用されます。 ボットに対してMicrosoft Teamsチャネルを有効にしてください。

ボット アプリ ID とアプリ パスワードを記録し、アプリ マニフェストにアプリ ID を指定する必要があります。

### <a name="update-your-app-manifest"></a>アプリ マニフェストを更新する

ボットとタブと同様に、メッセージング拡張機能の[](~/resources/schema/manifest-schema.md#composeextensions)プロパティを含めるアプリのマニフェストを更新します。 これらのプロパティは、メッセージング拡張機能がクライアントでどのように表示され、動作Microsoft Teamsします。 メッセージング拡張機能は、マニフェストの v1.0 からサポートされています。

#### <a name="declare-your-messaging-extension"></a>メッセージング拡張機能の宣言

メッセージング拡張機能を追加するには、プロパティを使用してマニフェストに新しいトップ レベルの JSON 構造を含 `composeExtensions` めます。 現時点では、アプリの 1 つのメッセージング拡張機能の作成に制限されています。

> [!NOTE]
> マニフェストは、メッセージング拡張機能を次のように参照します `composeExtensions` 。 これは、下位互換性を維持するための方法です。

拡張定義は、次の構造を持つオブジェクトです。

| プロパティ名 | 用途 | 必須 |
|---|---|---|
| `botId` | Bot Framework に登録された、ボット用の一意の Microsoft アプリ ID。 通常、これはアプリ全体の ID と同Teamsがあります。 | はい |
| `scopes` | この拡張機能を追加できるかどうか、スコープ (または両方) を宣言 `personal` `team` する配列。 | はい |
| `canUpdateConfiguration` | メニュー **設定** を有効にします。 | いいえ |
| `commands` | このメッセージング拡張機能がサポートするコマンドの配列。 コマンドは 10 に制限されています。 | はい |

#### <a name="define-commands"></a>コマンドの定義

メッセージング拡張機能は、作成ボックスの [その他のオプション **]** (&#8943;) ボタンからアプリを選択すると表示される **1** つのコマンドを宣言する必要があります。

![メッセージ内のメッセージング拡張機能の一覧のTeams](~/assets/images/compose-extensions/compose-extension-list.png)

アプリ マニフェストでは、コマンド アイテムは次の構造を持つオブジェクトです。

| プロパティ名 | 用途 | 必須 | マニフェストの最小バージョン |
|---|---|---|---|
| `id` | このコマンドに割り当てる一意の ID。 ユーザー要求には、この ID が含まれます。 | はい | 1.0 |
| `title` | コマンド名。 この値は UI に表示されます。 | はい | 1.0 |
| `description` | このコマンドの動作を示すヘルプ テキスト。 この値は UI に表示されます。 | はい | 1.0 |
| `type` | コマンドの種類を設定します。 使用可能な値は、`query`、`action` です。 存在しない場合、既定値は に設定されます `query` 。 | いいえ | 1.4 |
| `initialRun` | コマンドと一緒に使用されるオプション `query` のパラメーター。 true に **設定されている場合** は、ユーザーが UI でこのコマンドを選択するとすぐにこのコマンドを実行する必要があります。 | いいえ | 1.0 |
| `fetchTask` | コマンドと一緒に使用されるオプション `action` のパラメーター。 タスク モジュール **内に** 表示するアダプティブ カードまたは Web URL をフェッチするには、true に [設定します](~/task-modules-and-cards/what-are-task-modules.md)。 これは、静的なパラメーターのセットではなく、コマンドへの入力が動的 `action` である場合に使用されます。 if を true に設定 **すると** 、コマンドの静的パラメーター リストは無視されます。 | いいえ | 1.4 |
| `parameters` | コマンドのパラメーターの静的リスト。 | はい | 1.0 |
| `parameter.name` | パラメーターの名前です。 これは、ユーザー要求でサービスに送信されます。 | はい | 1.0 |
| `parameter.description` | 指定する必要がある値のこのパラメーターの目的または例について説明します。 この値は UI に表示されます。 | はい | 1.0 |
| `parameter.title` | 短いユーザーフレンドリーなパラメーターのタイトルまたはラベル。 | はい | 1.0 |
| `parameter.inputType` | 必要な入力の種類に設定します。 可能な値 `text` には `textarea` 、、 `number` 、 、 、 、 `date` `time` が含まれます `toggle` 。 既定値は に設定されています `text` 。 | いいえ | 1.4 |
| `context` | メッセージ アクションが使用できるコンテキストを定義する値のオプションの配列。 指定できる値 `message` は `compose` 、、、または `commandBox` です。 既定値は `["compose", "commandBox"]` です。 | いいえ | 1.5 |
