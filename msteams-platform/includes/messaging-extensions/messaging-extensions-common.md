## <a name="add-a-messaging-extension-to-your-app"></a><span data-ttu-id="82d46-101">メッセージング拡張機能をアプリに追加する</span><span class="sxs-lookup"><span data-stu-id="82d46-101">Add a messaging extension to your app</span></span>

<span data-ttu-id="82d46-102">メッセージング拡張機能は、ユーザーの要求を待機し、[カード](~/task-modules-and-cards/what-are-cards.md)などの構造化データを使用して応答する、クラウドでホストされるサービスです。</span><span class="sxs-lookup"><span data-stu-id="82d46-102">A messaging extension is a cloud-hosted service that listens to user requests and responds with structured data, such as a [card](~/task-modules-and-cards/what-are-cards.md).</span></span> <span data-ttu-id="82d46-103">Bot フレームワーク`Activity`オブジェクトを使用して、サービスを Microsoft Teams と統合します。</span><span class="sxs-lookup"><span data-stu-id="82d46-103">You integrate your service with Microsoft Teams via Bot Framework `Activity` objects.</span></span> <span data-ttu-id="82d46-104">Bot ビルダー SDK の .NET および node.js 拡張子は、メッセージング拡張機能をアプリに追加するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="82d46-104">Our .NET and Node.js extensions for the Bot Builder SDK can help you add messaging extension functionality to your app.</span></span>

![メッセージング拡張機能のメッセージフローの図](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a><span data-ttu-id="82d46-106">Bot フレームワークに登録する</span><span class="sxs-lookup"><span data-stu-id="82d46-106">Register in the Bot Framework</span></span>

<span data-ttu-id="82d46-107">まだお持ちでない場合は、最初に bot を Microsoft Bot フレームワークに登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82d46-107">If you haven’t done so already, you must first register a bot with the Microsoft Bot Framework.</span></span> <span data-ttu-id="82d46-108">Bot の Microsoft app ID とコールバックエンドポイントは、そこに定義されているように、メッセージング拡張機能でユーザーの要求を受信して応答するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-108">The Microsoft app ID and callback endpoints for your bot, as defined there, will be used in your messaging extension to receive and respond to user requests.</span></span> <span data-ttu-id="82d46-109">Bot の Microsoft Teams チャネルを必ず有効にしてください。</span><span class="sxs-lookup"><span data-stu-id="82d46-109">Remember to enable the Microsoft Teams channel for your bot.</span></span>

<span data-ttu-id="82d46-110">Bot アプリ ID とアプリパスワードを記録するには、アプリのマニフェストにアプリ ID を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82d46-110">Record your bot app ID and app password, you will need to supply the app ID in your app manifest.</span></span>

### <a name="update-your-app-manifest"></a><span data-ttu-id="82d46-111">アプリのマニフェストを更新する</span><span class="sxs-lookup"><span data-stu-id="82d46-111">Update your app manifest</span></span>

<span data-ttu-id="82d46-112">ボットやタブの場合と同様に、メッセージング拡張機能のプロパティを含むようにアプリの[マニフェスト](~/resources/schema/manifest-schema.md#composeextensions)を更新します。</span><span class="sxs-lookup"><span data-stu-id="82d46-112">As with bots and tabs, you update the [manifest](~/resources/schema/manifest-schema.md#composeextensions) of your app to include the messaging extension properties.</span></span> <span data-ttu-id="82d46-113">これらのプロパティは、Microsoft Teams クライアントでメッセージング拡張機能がどのように表示され、動作するかを制御します。</span><span class="sxs-lookup"><span data-stu-id="82d46-113">These properties govern how your messaging extension appears and behaves in the Microsoft Teams client.</span></span> <span data-ttu-id="82d46-114">メッセージング内線番号は、マニフェストの v 1.0 以降でサポートされています。</span><span class="sxs-lookup"><span data-stu-id="82d46-114">Messaging extensions are supported beginning with v1.0 of the manifest.</span></span>

#### <a name="declare-your-messaging-extension"></a><span data-ttu-id="82d46-115">メッセージング拡張機能を宣言する</span><span class="sxs-lookup"><span data-stu-id="82d46-115">Declare your messaging extension</span></span>

<span data-ttu-id="82d46-116">メッセージング拡張機能を追加するには、 `composeExtensions`プロパティを使用して、マニフェストに新しいトップレベルの JSON 構造を含めます。</span><span class="sxs-lookup"><span data-stu-id="82d46-116">To add a messaging extension, include a new top-level JSON structure in your manifest with the `composeExtensions` property.</span></span> <span data-ttu-id="82d46-117">現時点では、アプリに対して単一のメッセージング拡張機能の作成が制限されています。</span><span class="sxs-lookup"><span data-stu-id="82d46-117">Currently, you are limited to creating a single messaging extension for your app.</span></span>

> [!NOTE]
> <span data-ttu-id="82d46-118">マニフェストは、として`composeExtensions`メッセージング拡張機能を参照します。</span><span class="sxs-lookup"><span data-stu-id="82d46-118">The manifest refers to messaging extensions as `composeExtensions`.</span></span> <span data-ttu-id="82d46-119">これは、下位互換性を維持するためのものです。</span><span class="sxs-lookup"><span data-stu-id="82d46-119">This is to maintain backward compatibility.</span></span>

<span data-ttu-id="82d46-120">拡張機能の定義は、次の構造を持つオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="82d46-120">The extension definition is an object that has the following structure:</span></span>

| <span data-ttu-id="82d46-121">プロパティ名</span><span class="sxs-lookup"><span data-stu-id="82d46-121">Property name</span></span> | <span data-ttu-id="82d46-122">用途</span><span class="sxs-lookup"><span data-stu-id="82d46-122">Purpose</span></span> | <span data-ttu-id="82d46-123">必須</span><span class="sxs-lookup"><span data-stu-id="82d46-123">Required?</span></span> |
|---|---|---|
| `botId` | <span data-ttu-id="82d46-124">Bot フレームワークに登録された bot の一意の Microsoft アプリ ID。</span><span class="sxs-lookup"><span data-stu-id="82d46-124">The unique Microsoft app ID for the bot as registered with the Bot Framework.</span></span> <span data-ttu-id="82d46-125">これは通常、Teams アプリ全体の ID と同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="82d46-125">This should typically be the same as the ID for your overall Teams app.</span></span> | <span data-ttu-id="82d46-126">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-126">Yes</span></span> |
| `scopes` | <span data-ttu-id="82d46-127">この内線番号をまたは`personal` `team`範囲に追加できるか、またはその両方を追加できるかを宣言する配列。</span><span class="sxs-lookup"><span data-stu-id="82d46-127">Array declaring whether this extension can be added to `personal` or `team` scopes (or both).</span></span> | <span data-ttu-id="82d46-128">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-128">Yes</span></span> |
| `canUpdateConfiguration` | <span data-ttu-id="82d46-129">**設定**メニュー項目を有効にします。</span><span class="sxs-lookup"><span data-stu-id="82d46-129">Enables **Settings** menu item.</span></span> | <span data-ttu-id="82d46-130">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-130">No</span></span> |
| `commands` | <span data-ttu-id="82d46-131">このメッセージング拡張機能がサポートするコマンドの配列です。</span><span class="sxs-lookup"><span data-stu-id="82d46-131">Array of commands that this messaging extension supports.</span></span> <span data-ttu-id="82d46-132">コマンドは10個に制限されています。</span><span class="sxs-lookup"><span data-stu-id="82d46-132">You are limited to 10 commands.</span></span> | <span data-ttu-id="82d46-133">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-133">Yes</span></span> |

#### <a name="define-commands"></a><span data-ttu-id="82d46-134">コマンドを定義する</span><span class="sxs-lookup"><span data-stu-id="82d46-134">Define commands</span></span>

<span data-ttu-id="82d46-135">メッセージング拡張機能では、ユーザーが [新規作成] ボックスの [**その他のオプション**(**&#8943;**)] ボタンからアプリを選択したときに表示されるコマンドを1つ宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82d46-135">Your messaging extension should declare one command, which appears when the user selects your app from the **More options** (**&#8943;**) button in the compose box.</span></span>

![Teams でのメッセージング拡張機能のリストのスクリーンショット](~/assets/images/compose-extensions/compose-extension-list.png)

<span data-ttu-id="82d46-137">アプリマニフェストのコマンド項目は、次の構造を持つオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="82d46-137">In the app manifest, your command item is an object with the following structure:</span></span>

| <span data-ttu-id="82d46-138">プロパティ名</span><span class="sxs-lookup"><span data-stu-id="82d46-138">Property name</span></span> | <span data-ttu-id="82d46-139">用途</span><span class="sxs-lookup"><span data-stu-id="82d46-139">Purpose</span></span> | <span data-ttu-id="82d46-140">必須</span><span class="sxs-lookup"><span data-stu-id="82d46-140">Required?</span></span> | <span data-ttu-id="82d46-141">マニフェストの最小バージョン</span><span class="sxs-lookup"><span data-stu-id="82d46-141">Minimum manifest version</span></span> |
|---|---|---|---|
| `id` | <span data-ttu-id="82d46-142">このコマンドに割り当てる一意の ID です。</span><span class="sxs-lookup"><span data-stu-id="82d46-142">Unique ID that you assign to this command.</span></span> <span data-ttu-id="82d46-143">ユーザー要求には、この ID が含まれます。</span><span class="sxs-lookup"><span data-stu-id="82d46-143">The user request will include this ID.</span></span> | <span data-ttu-id="82d46-144">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-144">Yes</span></span> | <span data-ttu-id="82d46-145">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-145">1.0</span></span> |
| `title` | <span data-ttu-id="82d46-146">コマンド名を指定します。</span><span class="sxs-lookup"><span data-stu-id="82d46-146">Command name.</span></span> <span data-ttu-id="82d46-147">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-147">This value appears in the UI.</span></span> | <span data-ttu-id="82d46-148">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-148">Yes</span></span> | <span data-ttu-id="82d46-149">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-149">1.0</span></span> |
| `description` | <span data-ttu-id="82d46-150">このコマンドの機能を示すヘルプテキスト。</span><span class="sxs-lookup"><span data-stu-id="82d46-150">Help text indicating what this command does.</span></span> <span data-ttu-id="82d46-151">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-151">This value appears in the UI.</span></span> | <span data-ttu-id="82d46-152">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-152">Yes</span></span> | <span data-ttu-id="82d46-153">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-153">1.0</span></span> |
| `type` | <span data-ttu-id="82d46-154">コマンドの種類を設定します。</span><span class="sxs-lookup"><span data-stu-id="82d46-154">Set the type of command.</span></span> <span data-ttu-id="82d46-155">使用可能な値は、`query`、`action` です。</span><span class="sxs-lookup"><span data-stu-id="82d46-155">Possible values include `query` and `action`.</span></span> <span data-ttu-id="82d46-156">指定しない場合、既定値はに設定されます。`query`</span><span class="sxs-lookup"><span data-stu-id="82d46-156">If not present the default value is set to `query`</span></span> | <span data-ttu-id="82d46-157">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-157">No</span></span> | <span data-ttu-id="82d46-158">1.4</span><span class="sxs-lookup"><span data-stu-id="82d46-158">1.4</span></span> |
| `initialRun` | <span data-ttu-id="82d46-159">省略可能なパラメーターで`query` 、コマンドと共に使用します。</span><span class="sxs-lookup"><span data-stu-id="82d46-159">Optional parameter, used with `query` commands.</span></span> <span data-ttu-id="82d46-160">**True**に設定すると、ユーザーが UI でこのコマンドを選択するとすぐにこのコマンドが実行されることを示します。</span><span class="sxs-lookup"><span data-stu-id="82d46-160">If set to **true**, indicates this command should be executed as soon as the user chooses this command in the UI.</span></span> | <span data-ttu-id="82d46-161">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-161">No</span></span> | <span data-ttu-id="82d46-162">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-162">1.0</span></span> |
| `fetchTask` | <span data-ttu-id="82d46-163">省略可能なパラメーターで`action` 、コマンドと共に使用します。</span><span class="sxs-lookup"><span data-stu-id="82d46-163">Optional parameter, used with `action` commands.</span></span> <span data-ttu-id="82d46-164">**True**に設定すると、[タスクモジュール](~/task-modules-and-cards/what-are-task-modules.md)内に表示するアダプティブカードまたは web url を取得します。</span><span class="sxs-lookup"><span data-stu-id="82d46-164">Set to **true** to fetch the adaptive card or web url to display within the [task module](~/task-modules-and-cards/what-are-task-modules.md).</span></span> <span data-ttu-id="82d46-165">これは、 `action`コマンドへの入力が、パラメーターの静的なセットではなく動的になる場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-165">This is used when the inputs to the `action` command is dynamic as opposed to a static set of parameters.</span></span> <span data-ttu-id="82d46-166">**True**に設定すると、コマンドの静的パラメータリストは無視されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82d46-166">Note that the if set to **true** the static parameter list for the command is ignored</span></span> | <span data-ttu-id="82d46-167">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-167">No</span></span> | <span data-ttu-id="82d46-168">1.4</span><span class="sxs-lookup"><span data-stu-id="82d46-168">1.4</span></span> |
| `parameters` | <span data-ttu-id="82d46-169">コマンドのパラメーターの静的リスト。</span><span class="sxs-lookup"><span data-stu-id="82d46-169">Static list of parameters for the command.</span></span> | <span data-ttu-id="82d46-170">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-170">Yes</span></span> | <span data-ttu-id="82d46-171">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-171">1.0</span></span> |
| `parameter.name` | <span data-ttu-id="82d46-172">パラメーターの名前です。</span><span class="sxs-lookup"><span data-stu-id="82d46-172">The name of the parameter.</span></span> <span data-ttu-id="82d46-173">これは、ユーザーの要求でサービスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-173">This is sent to your service in the user request.</span></span> | <span data-ttu-id="82d46-174">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-174">Yes</span></span> | <span data-ttu-id="82d46-175">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-175">1.0</span></span> |
| `parameter.description` | <span data-ttu-id="82d46-176">このパラメーターの目的または提供する必要がある値の例について説明します。</span><span class="sxs-lookup"><span data-stu-id="82d46-176">Describes this parameter’s purposes or example of the value that should be provided.</span></span> <span data-ttu-id="82d46-177">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="82d46-177">This value appears in the UI.</span></span> | <span data-ttu-id="82d46-178">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-178">Yes</span></span> | <span data-ttu-id="82d46-179">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-179">1.0</span></span> |
| `parameter.title` | <span data-ttu-id="82d46-180">簡単なユーザーフレンドリパラメーターのタイトルまたはラベル。</span><span class="sxs-lookup"><span data-stu-id="82d46-180">Short user-friendly parameter title or label.</span></span> | <span data-ttu-id="82d46-181">はい</span><span class="sxs-lookup"><span data-stu-id="82d46-181">Yes</span></span> | <span data-ttu-id="82d46-182">1.0</span><span class="sxs-lookup"><span data-stu-id="82d46-182">1.0</span></span> |
| `parameter.inputType` | <span data-ttu-id="82d46-183">必要な入力の種類を設定します。</span><span class="sxs-lookup"><span data-stu-id="82d46-183">Set to the type of input required.</span></span> <span data-ttu-id="82d46-184">可能な値`text`は`textarea`、 `number` `date` `time`、、、 `toggle`、です。</span><span class="sxs-lookup"><span data-stu-id="82d46-184">Possible values include `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span></span> <span data-ttu-id="82d46-185">既定値はに設定されています`text`</span><span class="sxs-lookup"><span data-stu-id="82d46-185">Default is set to `text`</span></span> | <span data-ttu-id="82d46-186">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-186">No</span></span> | <span data-ttu-id="82d46-187">1.4</span><span class="sxs-lookup"><span data-stu-id="82d46-187">1.4</span></span> |
| `context` | <span data-ttu-id="82d46-188">メッセージアクションが使用可能なコンテキストを定義する値のオプションの配列です。</span><span class="sxs-lookup"><span data-stu-id="82d46-188">Optional array of values that defines the context the message action is available in.</span></span> <span data-ttu-id="82d46-189">可能な値`message`は`compose`、、 `commandBox`、です。</span><span class="sxs-lookup"><span data-stu-id="82d46-189">Possible values are `message`, `compose`, or `commandBox`.</span></span> <span data-ttu-id="82d46-190">既定値は `["compose", "commandBox"]` です。</span><span class="sxs-lookup"><span data-stu-id="82d46-190">Default is `["compose", "commandBox"]`.</span></span> | <span data-ttu-id="82d46-191">いいえ</span><span class="sxs-lookup"><span data-stu-id="82d46-191">No</span></span> | <span data-ttu-id="82d46-192">1.5</span><span class="sxs-lookup"><span data-stu-id="82d46-192">1.5</span></span> |
