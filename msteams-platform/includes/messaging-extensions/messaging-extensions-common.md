## <a name="add-a-messaging-extension-to-your-app"></a>アプリにメッセージング拡張機能を追加する

メッセージング拡張機能は、ユーザーの要求をリッスンし、 [カード](~/task-modules-and-cards/what-are-cards.md)などの構造化されたデータで応答するクラウド ホスト型サービスです。 サービスは、Bot Framework オブジェクトを介してMicrosoft Teamsと統合 `Activity` します。 ボット ビルダー SDK の .NET およびNode.js拡張機能を使用すると、アプリにメッセージング拡張機能を追加できます。

![メッセージング拡張機能のメッセージ フローの図](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>ボット フレームワークに登録する

まだ登録していない場合は、最初にボットをMicrosoft Bot Frameworkに登録する必要があります。 ボットの Microsoft アプリ ID エンドポイントとコールバック エンドポイントは、そこで定義されているように、メッセージング拡張機能でユーザーの要求を受信して応答するために使用されます。 ボットのMicrosoft Teamsチャネルを有効にすることを忘れないでください。

ボット アプリ ID とアプリ パスワードを記録すると、アプリ マニフェストでアプリ ID を入力する必要があります。

### <a name="update-your-app-manifest"></a>アプリ マニフェストを更新する

ボットやタブと同様に、メッセージング拡張機能のプロパティを含むようにアプリの [マニフェスト](~/resources/schema/manifest-schema.md#composeextensions) を更新します。 これらのプロパティは、メッセージング拡張機能がMicrosoft Teams クライアントでどのように表示され、動作するかを制御します。 メッセージング拡張機能は、マニフェストの v1.0 以降でサポートされています。

#### <a name="declare-your-messaging-extension"></a>メッセージング拡張機能を宣言する

メッセージング拡張機能を追加するには、プロパティを使用してマニフェストに新しい最上位の JSON 構造を含 `composeExtensions` めます。 現時点では、アプリのメッセージング拡張機能を 1 つだけ作成できます。

> [!NOTE]
> マニフェストでは、メッセージング拡張機能を `composeExtensions` . これは、下位互換性を維持するためです。

拡張定義は、次の構造を持つオブジェクトです。

| プロパティ名 | 用途 | 必須 |
|---|---|---|
| `botId` | Bot Framework に登録された、ボット用の一意の Microsoft アプリ ID。 通常、これは、アプリ全体の ID と同じTeams必要があります。 | はい |
| `scopes` | この拡張機能を `personal` 追加できるかどうか、 `team` またはスコープ (またはその両方) を追加できるかどうかを宣言する配列。 | はい |
| `canUpdateConfiguration` | **メニュー項目設定** 有効にします。 | いいえ |
| `commands` | このメッセージング拡張機能がサポートするコマンドの配列。 コマンドは 10 個に制限されています。 | はい |

#### <a name="define-commands"></a>コマンドの定義

メッセージング拡張機能は、ユーザーが新規作成ボックスの **[その他のオプション** ] (**&#8943;**) ボタンからアプリを選択したときに表示される 1 つのコマンドを宣言する必要があります。

![Teamsのメッセージング拡張機能の一覧のスクリーンショット](~/assets/images/compose-extensions/compose-extension-list.png)

アプリ マニフェストでは、コマンド項目は次の構造のオブジェクトです。

| プロパティ名 | 用途 | 必須 | 最小マニフェスト バージョン |
|---|---|---|---|
| `id` | このコマンドに割り当てる一意の ID。 ユーザー要求には、この ID が含まれます。 | はい | 1.0 |
| `title` | コマンド名。 この値は UI に表示されます。 | はい | 1.0 |
| `description` | このコマンドの動作を示すヘルプ テキスト。 この値は UI に表示されます。 | はい | 1.0 |
| `type` | コマンドの種類を設定します。 使用可能な値は、`query`、`action` です。 存在しない場合、既定値は に設定 `query` されます。 | いいえ | 1.4 |
| `initialRun` | コマンドで使用される省略可能なパラメーター `query` 。 **true** に設定すると、ユーザーが UI でこのコマンドを選択するとすぐにこのコマンドが実行されます。 | いいえ | 1.0 |
| `fetchTask` | コマンドで使用される省略可能なパラメーター `action` 。 [タスク モジュール](~/task-modules-and-cards/what-are-task-modules.md)内に表示するアダプティブ カードまたは Web URL をフェッチするには **、true** に設定します。 これは、 `action` 静的なパラメーター セットではなく、コマンドへの入力が動的である場合に使用されます。 **true** に設定すると、コマンドの静的パラメーター・リストは無視されます。 | いいえ | 1.4 |
| `parameters` | コマンドのパラメーターの静的リスト。 | はい | 1.0 |
| `parameter.name` | パラメーターの名前です。 これは、ユーザー要求でサービスに送信されます。 | はい | 1.0 |
| `parameter.description` | このパラメーターの目的または値の例を示します。 この値は UI に表示されます。 | はい | 1.0 |
| `parameter.title` | 短いユーザー フレンドリーなパラメーターのタイトルまたはラベル。 | はい | 1.0 |
| `parameter.inputType` | 必要な入力の種類に設定します。 使用できる値 `text` には `textarea` 、 、 、 、 `number` 、 `date` `time` が含 `toggle` まれます。 既定値は `text` に設定されています。 | いいえ | 1.4 |
| `context` | メッセージ アクションが使用できるコンテキストを定義する値の配列 (省略可能)。 使用できる値 `message` は `compose` 、 、 、または `commandBox` です。 既定値は `["compose", "commandBox"]` です。 | いいえ | 1.5 |
