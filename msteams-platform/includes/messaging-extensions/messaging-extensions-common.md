## <a name="add-a-messaging-extension-to-your-app"></a><span data-ttu-id="1ad51-101">アプリにメッセージング拡張機能を追加する</span><span class="sxs-lookup"><span data-stu-id="1ad51-101">Add a messaging extension to your app</span></span>

<span data-ttu-id="1ad51-102">メッセージング拡張機能は、ユーザーの要求をリッスンし、 [カード](~/task-modules-and-cards/what-are-cards.md)などの構造化されたデータで応答するクラウド ホスト型サービスです。</span><span class="sxs-lookup"><span data-stu-id="1ad51-102">A messaging extension is a cloud-hosted service that listens to user requests and responds with structured data, such as a [card](~/task-modules-and-cards/what-are-cards.md).</span></span> <span data-ttu-id="1ad51-103">サービスは、Bot Framework オブジェクトを介してMicrosoft Teamsと統合 `Activity` します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-103">You integrate your service with Microsoft Teams via Bot Framework `Activity` objects.</span></span> <span data-ttu-id="1ad51-104">ボット ビルダー SDK の .NET およびNode.js拡張機能を使用すると、アプリにメッセージング拡張機能を追加できます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-104">Our .NET and Node.js extensions for the Bot Builder SDK can help you add messaging extension functionality to your app.</span></span>

![メッセージング拡張機能のメッセージ フローの図](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a><span data-ttu-id="1ad51-106">ボット フレームワークに登録する</span><span class="sxs-lookup"><span data-stu-id="1ad51-106">Register in the Bot Framework</span></span>

<span data-ttu-id="1ad51-107">まだ登録していない場合は、最初にボットをMicrosoft Bot Frameworkに登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1ad51-107">If you haven’t done so already, you must first register a bot with the Microsoft Bot Framework.</span></span> <span data-ttu-id="1ad51-108">ボットの Microsoft アプリ ID エンドポイントとコールバック エンドポイントは、そこで定義されているように、メッセージング拡張機能でユーザーの要求を受信して応答するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-108">The Microsoft app ID and callback endpoints for your bot, as defined there, will be used in your messaging extension to receive and respond to user requests.</span></span> <span data-ttu-id="1ad51-109">ボットのMicrosoft Teamsチャネルを有効にすることを忘れないでください。</span><span class="sxs-lookup"><span data-stu-id="1ad51-109">Remember to enable the Microsoft Teams channel for your bot.</span></span>

<span data-ttu-id="1ad51-110">ボット アプリ ID とアプリ パスワードを記録すると、アプリ マニフェストでアプリ ID を入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1ad51-110">Record your bot app ID and app password, you will need to supply the app ID in your app manifest.</span></span>

### <a name="update-your-app-manifest"></a><span data-ttu-id="1ad51-111">アプリ マニフェストを更新する</span><span class="sxs-lookup"><span data-stu-id="1ad51-111">Update your app manifest</span></span>

<span data-ttu-id="1ad51-112">ボットやタブと同様に、メッセージング拡張機能のプロパティを含むようにアプリの [マニフェスト](~/resources/schema/manifest-schema.md#composeextensions) を更新します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-112">As with bots and tabs, you update the [manifest](~/resources/schema/manifest-schema.md#composeextensions) of your app to include the messaging extension properties.</span></span> <span data-ttu-id="1ad51-113">これらのプロパティは、メッセージング拡張機能がMicrosoft Teams クライアントでどのように表示され、動作するかを制御します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-113">These properties govern how your messaging extension appears and behaves in the Microsoft Teams client.</span></span> <span data-ttu-id="1ad51-114">メッセージング拡張機能は、マニフェストの v1.0 以降でサポートされています。</span><span class="sxs-lookup"><span data-stu-id="1ad51-114">Messaging extensions are supported beginning with v1.0 of the manifest.</span></span>

#### <a name="declare-your-messaging-extension"></a><span data-ttu-id="1ad51-115">メッセージング拡張機能を宣言する</span><span class="sxs-lookup"><span data-stu-id="1ad51-115">Declare your messaging extension</span></span>

<span data-ttu-id="1ad51-116">メッセージング拡張機能を追加するには、プロパティを使用してマニフェストに新しい最上位の JSON 構造を含 `composeExtensions` めます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-116">To add a messaging extension, include a new top-level JSON structure in your manifest with the `composeExtensions` property.</span></span> <span data-ttu-id="1ad51-117">現時点では、アプリのメッセージング拡張機能を 1 つだけ作成できます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-117">Currently, you are limited to creating a single messaging extension for your app.</span></span>

> [!NOTE]
> <span data-ttu-id="1ad51-118">マニフェストでは、メッセージング拡張機能を `composeExtensions` .</span><span class="sxs-lookup"><span data-stu-id="1ad51-118">The manifest refers to messaging extensions as `composeExtensions`.</span></span> <span data-ttu-id="1ad51-119">これは、下位互換性を維持するためです。</span><span class="sxs-lookup"><span data-stu-id="1ad51-119">This is to maintain backward compatibility.</span></span>

<span data-ttu-id="1ad51-120">拡張定義は、次の構造を持つオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="1ad51-120">The extension definition is an object that has the following structure:</span></span>

| <span data-ttu-id="1ad51-121">プロパティ名</span><span class="sxs-lookup"><span data-stu-id="1ad51-121">Property name</span></span> | <span data-ttu-id="1ad51-122">用途</span><span class="sxs-lookup"><span data-stu-id="1ad51-122">Purpose</span></span> | <span data-ttu-id="1ad51-123">必須</span><span class="sxs-lookup"><span data-stu-id="1ad51-123">Required?</span></span> |
|---|---|---|
| `botId` | <span data-ttu-id="1ad51-124">Bot Framework に登録された、ボット用の一意の Microsoft アプリ ID。</span><span class="sxs-lookup"><span data-stu-id="1ad51-124">The unique Microsoft app ID for the bot as registered with the Bot Framework.</span></span> <span data-ttu-id="1ad51-125">通常、これは、アプリ全体の ID と同じTeams必要があります。</span><span class="sxs-lookup"><span data-stu-id="1ad51-125">This should typically be the same as the ID for your overall Teams app.</span></span> | <span data-ttu-id="1ad51-126">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-126">Yes</span></span> |
| `scopes` | <span data-ttu-id="1ad51-127">この拡張機能を `personal` 追加できるかどうか、 `team` またはスコープ (またはその両方) を追加できるかどうかを宣言する配列。</span><span class="sxs-lookup"><span data-stu-id="1ad51-127">Array declaring whether this extension can be added to `personal` or `team` scopes (or both).</span></span> | <span data-ttu-id="1ad51-128">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-128">Yes</span></span> |
| `canUpdateConfiguration` | <span data-ttu-id="1ad51-129">**メニュー項目設定** 有効にします。</span><span class="sxs-lookup"><span data-stu-id="1ad51-129">Enables **Settings** menu item.</span></span> | <span data-ttu-id="1ad51-130">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-130">No</span></span> |
| `commands` | <span data-ttu-id="1ad51-131">このメッセージング拡張機能がサポートするコマンドの配列。</span><span class="sxs-lookup"><span data-stu-id="1ad51-131">Array of commands that this messaging extension supports.</span></span> <span data-ttu-id="1ad51-132">コマンドは 10 個に制限されています。</span><span class="sxs-lookup"><span data-stu-id="1ad51-132">You are limited to 10 commands.</span></span> | <span data-ttu-id="1ad51-133">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-133">Yes</span></span> |

#### <a name="define-commands"></a><span data-ttu-id="1ad51-134">コマンドの定義</span><span class="sxs-lookup"><span data-stu-id="1ad51-134">Define commands</span></span>

<span data-ttu-id="1ad51-135">メッセージング拡張機能は、ユーザーが新規作成ボックスの **[その他のオプション** ] (**&#8943;**) ボタンからアプリを選択したときに表示される 1 つのコマンドを宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1ad51-135">Your messaging extension should declare one command, which appears when the user selects your app from the **More options** (**&#8943;**) button in the compose box.</span></span>

![Teamsのメッセージング拡張機能の一覧のスクリーンショット](~/assets/images/compose-extensions/compose-extension-list.png)

<span data-ttu-id="1ad51-137">アプリ マニフェストでは、コマンド項目は次の構造のオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="1ad51-137">In the app manifest, your command item is an object with the following structure:</span></span>

| <span data-ttu-id="1ad51-138">プロパティ名</span><span class="sxs-lookup"><span data-stu-id="1ad51-138">Property name</span></span> | <span data-ttu-id="1ad51-139">用途</span><span class="sxs-lookup"><span data-stu-id="1ad51-139">Purpose</span></span> | <span data-ttu-id="1ad51-140">必須</span><span class="sxs-lookup"><span data-stu-id="1ad51-140">Required?</span></span> | <span data-ttu-id="1ad51-141">最小マニフェスト バージョン</span><span class="sxs-lookup"><span data-stu-id="1ad51-141">Minimum manifest version</span></span> |
|---|---|---|---|
| `id` | <span data-ttu-id="1ad51-142">このコマンドに割り当てる一意の ID。</span><span class="sxs-lookup"><span data-stu-id="1ad51-142">Unique ID that you assign to this command.</span></span> <span data-ttu-id="1ad51-143">ユーザー要求には、この ID が含まれます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-143">The user request will include this ID.</span></span> | <span data-ttu-id="1ad51-144">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-144">Yes</span></span> | <span data-ttu-id="1ad51-145">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-145">1.0</span></span> |
| `title` | <span data-ttu-id="1ad51-146">コマンド名。</span><span class="sxs-lookup"><span data-stu-id="1ad51-146">Command name.</span></span> <span data-ttu-id="1ad51-147">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-147">This value appears in the UI.</span></span> | <span data-ttu-id="1ad51-148">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-148">Yes</span></span> | <span data-ttu-id="1ad51-149">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-149">1.0</span></span> |
| `description` | <span data-ttu-id="1ad51-150">このコマンドの動作を示すヘルプ テキスト。</span><span class="sxs-lookup"><span data-stu-id="1ad51-150">Help text indicating what this command does.</span></span> <span data-ttu-id="1ad51-151">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-151">This value appears in the UI.</span></span> | <span data-ttu-id="1ad51-152">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-152">Yes</span></span> | <span data-ttu-id="1ad51-153">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-153">1.0</span></span> |
| `type` | <span data-ttu-id="1ad51-154">コマンドの種類を設定します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-154">Set the type of command.</span></span> <span data-ttu-id="1ad51-155">使用可能な値は、`query`、`action` です。</span><span class="sxs-lookup"><span data-stu-id="1ad51-155">Possible values include `query` and `action`.</span></span> <span data-ttu-id="1ad51-156">存在しない場合、既定値は に設定 `query` されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-156">If not present the default value is set to `query`.</span></span> | <span data-ttu-id="1ad51-157">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-157">No</span></span> | <span data-ttu-id="1ad51-158">1.4</span><span class="sxs-lookup"><span data-stu-id="1ad51-158">1.4</span></span> |
| `initialRun` | <span data-ttu-id="1ad51-159">コマンドで使用される省略可能なパラメーター `query` 。</span><span class="sxs-lookup"><span data-stu-id="1ad51-159">Optional parameter, used with `query` commands.</span></span> <span data-ttu-id="1ad51-160">**true** に設定すると、ユーザーが UI でこのコマンドを選択するとすぐにこのコマンドが実行されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-160">If set to **true**, indicates this command should be executed as soon as the user chooses this command in the UI.</span></span> | <span data-ttu-id="1ad51-161">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-161">No</span></span> | <span data-ttu-id="1ad51-162">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-162">1.0</span></span> |
| `fetchTask` | <span data-ttu-id="1ad51-163">コマンドで使用される省略可能なパラメーター `action` 。</span><span class="sxs-lookup"><span data-stu-id="1ad51-163">Optional parameter, used with `action` commands.</span></span> <span data-ttu-id="1ad51-164">[タスク モジュール](~/task-modules-and-cards/what-are-task-modules.md)内に表示するアダプティブ カードまたは Web URL をフェッチするには **、true** に設定します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-164">Set to **true** to fetch the adaptive card or web url to display within the [task module](~/task-modules-and-cards/what-are-task-modules.md).</span></span> <span data-ttu-id="1ad51-165">これは、 `action` 静的なパラメーター セットではなく、コマンドへの入力が動的である場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-165">This is used when the inputs to the `action` command is dynamic as opposed to a static set of parameters.</span></span> <span data-ttu-id="1ad51-166">**true** に設定すると、コマンドの静的パラメーター・リストは無視されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-166">Note that the if set to **true** the static parameter list for the command is ignored.</span></span> | <span data-ttu-id="1ad51-167">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-167">No</span></span> | <span data-ttu-id="1ad51-168">1.4</span><span class="sxs-lookup"><span data-stu-id="1ad51-168">1.4</span></span> |
| `parameters` | <span data-ttu-id="1ad51-169">コマンドのパラメーターの静的リスト。</span><span class="sxs-lookup"><span data-stu-id="1ad51-169">Static list of parameters for the command.</span></span> | <span data-ttu-id="1ad51-170">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-170">Yes</span></span> | <span data-ttu-id="1ad51-171">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-171">1.0</span></span> |
| `parameter.name` | <span data-ttu-id="1ad51-172">パラメーターの名前です。</span><span class="sxs-lookup"><span data-stu-id="1ad51-172">The name of the parameter.</span></span> <span data-ttu-id="1ad51-173">これは、ユーザー要求でサービスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-173">This is sent to your service in the user request.</span></span> | <span data-ttu-id="1ad51-174">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-174">Yes</span></span> | <span data-ttu-id="1ad51-175">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-175">1.0</span></span> |
| `parameter.description` | <span data-ttu-id="1ad51-176">このパラメーターの目的または値の例を示します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-176">Describes this parameter’s purposes or example of the value that should be provided.</span></span> <span data-ttu-id="1ad51-177">この値は UI に表示されます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-177">This value appears in the UI.</span></span> | <span data-ttu-id="1ad51-178">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-178">Yes</span></span> | <span data-ttu-id="1ad51-179">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-179">1.0</span></span> |
| `parameter.title` | <span data-ttu-id="1ad51-180">短いユーザー フレンドリーなパラメーターのタイトルまたはラベル。</span><span class="sxs-lookup"><span data-stu-id="1ad51-180">Short user-friendly parameter title or label.</span></span> | <span data-ttu-id="1ad51-181">はい</span><span class="sxs-lookup"><span data-stu-id="1ad51-181">Yes</span></span> | <span data-ttu-id="1ad51-182">1.0</span><span class="sxs-lookup"><span data-stu-id="1ad51-182">1.0</span></span> |
| `parameter.inputType` | <span data-ttu-id="1ad51-183">必要な入力の種類に設定します。</span><span class="sxs-lookup"><span data-stu-id="1ad51-183">Set to the type of input required.</span></span> <span data-ttu-id="1ad51-184">使用できる値 `text` には `textarea` 、 、 、 、 `number` 、 `date` `time` が含 `toggle` まれます。</span><span class="sxs-lookup"><span data-stu-id="1ad51-184">Possible values include `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span></span> <span data-ttu-id="1ad51-185">既定値は `text` に設定されています。</span><span class="sxs-lookup"><span data-stu-id="1ad51-185">Default is set to `text`.</span></span> | <span data-ttu-id="1ad51-186">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-186">No</span></span> | <span data-ttu-id="1ad51-187">1.4</span><span class="sxs-lookup"><span data-stu-id="1ad51-187">1.4</span></span> |
| `context` | <span data-ttu-id="1ad51-188">メッセージ アクションが使用できるコンテキストを定義する値の配列 (省略可能)。</span><span class="sxs-lookup"><span data-stu-id="1ad51-188">Optional array of values that defines the context the message action is available in.</span></span> <span data-ttu-id="1ad51-189">使用できる値 `message` は `compose` 、 、 、または `commandBox` です。</span><span class="sxs-lookup"><span data-stu-id="1ad51-189">Possible values are `message`, `compose`, or `commandBox`.</span></span> <span data-ttu-id="1ad51-190">既定値は `["compose", "commandBox"]` です。</span><span class="sxs-lookup"><span data-stu-id="1ad51-190">Default is `["compose", "commandBox"]`.</span></span> | <span data-ttu-id="1ad51-191">いいえ</span><span class="sxs-lookup"><span data-stu-id="1ad51-191">No</span></span> | <span data-ttu-id="1ad51-192">1.5</span><span class="sxs-lookup"><span data-stu-id="1ad51-192">1.5</span></span> |
