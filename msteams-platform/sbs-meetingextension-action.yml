### YamlMime:Tutorial
title: アクション ベースのメッセージング拡張機能をビルドする
metadata:
  title: アクション ベースのメッセージング拡張機能をビルドする
  description: このチュートリアルでは、Teamsのアクション メッセージング拡張機能を設定する方法について説明します。
  audience: Developer
  level: Beginner
  ms.date: 24/02/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: messaging-extensions/how-to/action-commands/define-action-command.md
  nextTutorialTitle: メッセージング拡張機能アクション コマンドを有効にする方法の詳細
  ms.custom: mvc
  ms.localizationpriority: high
  ms.openlocfilehash: 75da0ee4df510659a5adccf4f3e7ddd614592e27
  ms.sourcegitcommit: 61003a14e8a179e1268bbdbd9cf5e904c5259566
  ms.translationtype: MT
  ms.contentlocale: ja-JP
  ms.lasthandoff: 04/09/2022
  ms.locfileid: "64736927"
items:
- durationInMinutes: 1
  content: "メッセージング拡張機能を使用すると、ユーザーはMicrosoft Teams クライアントで Web サービスを操作できます。 これらは、メッセージ作成領域、コマンド ボックス、またはメッセージから直接、外部システムでアクションを開始するのに役立ちます。\n\n**アクション ベースのメッセージング拡張機能の主な機能**\n\n* 情報を収集または表示するためのモーダル ポップアップをユーザーに表示します。\n* メッセージ作成領域、コマンド ボックス、またはメッセージからアクション コマンドをトリガーします。 \n\nこのステップ バイ ステップ ガイドは、メッセージとメッセージの作成領域からアクションを開始するためのアクション ベースのメッセージング拡張機能Teams構築するのに役立ちます。 次の出力が表示されます。\n   \n  ![出力](~/assets/images/sbs-messagingextension-action/sharemessageoutput1.png)\n"
- title: 前提条件
  durationInMinutes: 1
  content: "次のツールをインストールし、開発環境を設定してください。  \n\n* 有効なアカウントを持つ[Microsoft Teams](https://teams.microsoft.com/)\n* [.NET Core SDK](https://dotnet.microsoft.com/download) バージョン 3.1\n* [Visual Studioの最新バージョン](https://visualstudio.microsoft.com/downloads/)\n* [ngrok](https://ngrok.com/download) の最新バージョン (devbox テスト用のみ) または同等のトンネリング ソリューション\n\n  > [!NOTE]\n  > ngrok をダウンロードしたら、サインアップして [authtoken](https://ngrok.com/download) をインストールします。\n"
- title: ローカル環境を設定する
  durationInMinutes: 1
  content: "リポジトリをローカル GitHubに複製`BotBuilder-Samples`します。  \n\n 1. [BotBuilder-Samples を](https://github.com/Microsoft/BotBuilder-Samples)開きます。\n 1. [ **コード**] を選択します。\n 1. ドロップダウン メニューから、[**デスクトップで開く] GitHub** 選択します。\n\n    ![リポジトリを複製する](~/assets/images/sbs-messagingextension-action/botbuilder-sample.png)\n\n 1. [ **複製**] を選択します。 \n"
- title: Azure AD ポータルでボットを作成して登録する
  durationInMinutes: 5
  content: "Microsoft Azure Active Directory (Azure AD) にボットを作成して登録するには、ngrok を使用してトンネルを作成し、メッセージング エンドポイントを追加するには、次の手順を実行します。\n\n* Azure bot リソースを作成して、Azure Bot Serviceにボットを登録します。\n* ボットの SSO 認証を有効にするクライアント シークレットを作成します。\n* Teams チャネルを追加して、ボットをTeams チャネルにデプロイします。\n* ngrok を使用して、Web サーバーのエンドポイントへのトンネルを作成します。\n* 作成した ngrok トンネルにメッセージング エンドポイントを追加します。\n\n**Azure Bot リソースを作成するには**\n\n1. [Microsoft Azure ポータル](https://portal.azure.com/)に移動します。\n1. **[リソースの作成]** を選択します。\n1. 検索ボックスに「 **Azure Bot**」と入力します。\n1. Enter キーを **押します**。\n1. **Azure Bot** を選択します。\n\n     ![Azure ボット カードを作成する](~/assets/images/sbs-messagingextension-action/azure-bot.png)\n\n1. **[作成]** を選択します。\n1. ボット ハンドルに必要な **ボット ハンドル** 名を入力します。\n1. ドロップダウン リストから **サブスクリプション** を選択します。\n1. ドロップダウン リストから **リソース グループ** を選択します。 \n\n    ![リソース Azure ボットを選択する](~/assets/images/sbs-messagingextension-action/create-azurebot.png) \n\n   新しいリソース グループを作成することもできます ([新しいリソースの **作成** ] を選択>、リソース名を入力> **[OK**] を選択します)。\n\n1. **[Microsoft アプリ ID**] セクションでは、既定で [**新しい Microsoft アプリ ID の作成]** が選択されています。 \n \n   [ **既存のアプリの登録を使用** する] を選択し、 **既存のアプリ ID** と **既存のアプリ パスワード** を入力するか、[ **新しい Microsoft アプリ ID の作成**] を選択します。\n\n   > [!NOTE]\n   > 同じ **Microsoft アプリ ID** を持つ複数のボットを作成することはできません。\n\n1. **[ボットの種類**] で **[MultiTenant**] を選択します。\n\n    ![種類](~/assets/images/sbs-messagingextension-action/bot-type.png)\n\n1. **[確認 + 作成]** を選びます。\n\n    ![Microsoft アプリ ID を作成する](~/assets/images/sbs-messagingextension-action/review-create.png)\n\n1. 検証に合格した場合は、[ **作成**] を選択します。 \n\n    ボット サービスをプロビジョニングするには、しばらく時間がかかります。 \n\n1. [**リソースに移動**] を選びます。 \n\n    ![アプリをデプロイする](~/assets/images/sbs-messagingextension-action/resource-file.png)\n\n    Azure ボットが作成されます。\n\n    ![作成された Azure ボット リソース](assets/images/sbs-messagingextension-action/created-azure-bot.png)\n\n**クライアント シークレットを作成するには**\n\n  新しい **Microsoft アプリ ID** を作成した場合は、次の手順を実行します。\n\n1. 左側のパネルで、[構成] を選択 **します**。 \n\n   > [!TIP]\n   > 今後参照できるように **、Microsoft アプリ ID** または **クライアント ID を** 保存します。\n\n1. **Microsoft アプリ ID** の横にある [**管理**] を選択します。\n\n    ![Microsoft アプリ ID](~/assets/images/sbs-messagingextension-action/manage.png)\n\n1. [ **クライアント シークレット** ] セクションで、[ **新しいクライアント シークレット**] を選択します。 \n\n    ![新しいクライアント シークレット](~/assets/images/sbs-messagingextension-action/adding-client-secret.png)\n\n   [ **クライアント シークレットの追加]** ウィンドウが表示されます。  \n\n1. **「説明」と入力します**。\n\n1. **[追加]** を選択します。\n\n    ![クライアント シークレットをアプリに追加する](~/assets/images/sbs-messagingextension-action/add-a-clientsecret.png)\n\n1. [ **値** ] 列で、[ **クリップボードにコピー**] を選択します。\n\n     ![クライアント シークレットの値](~/assets/images/sbs-messagingextension-action/client-secret.png)\n   \n   > [!TIP]\n   > 今後参照できるように **、クライアント シークレットの** 値またはアプリ パスワードを保存します。\n\n**Teams チャネルを追加するには**\n\n1. [**ホーム**] を選択します。\n\n    ![ホーム ページ](~/assets/images/sbs-messagingextension-action/select-home.png)\n\n1. **最近使用したリソース** からボットを選択します。\n\n1. 左側のウィンドウで **[チャネル** ] を選択します。 \n\n1. **Microsoft Teams** を選択する <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n1. [ **利用規約**] に同意するには、チェック ボックスをオンにします。\n\n1. **[同意する**] を選択します。\n\n      ![利用規約](~/assets/images/sbs-messagingextension-action/agree.png)\n\n1. **[保存]** を選択します。\n\n      ![Teamsを選択する](~/assets/images/sbs-messagingextension-action/configure-msteams.png)   \n\n**ローカル Web サーバーのトンネルを作成するには**\n\nngrok を使用して、ローカルで実行されている Web サーバーのパブリックに利用可能な HTTPS エンドポイントへのトンネルを作成します。 ngrok で次のコマンドを実行します。\n\n ```bash\n ngrok http -host-header=localhost 3978\n ```\n\n> [!TIP]\n> **ERR_NGROK_4018** が発生した場合は、コマンド プロンプトに記載されている手順に従って、サインアップして ngrok を認証します。 `ngrok http -host-header=localhost 3978` コマンドを実行します。\n\n**メッセージング エンドポイントを追加するには**\n\n1. ngrok から HTTPS URL (https から io) をコピーします。\n\n    ![ngrok HTTPS URL](~/assets/images/sbs-messagingextension-action/ngrok.png)\n\n    > [!NOTE]\n    > ngrok の HTTPS URL は、完全修飾ドメイン名です。\n    > は `WebAppDomain` 、それに含 `https://` まれていない完全修飾ドメイン名です。\n\n1. 作成 **した** Azure ボットの設定で、[構成] を選択 **します**。\n\n1. **メッセージング エンドポイント** で、ngrok から入手できる HTTPS URL を使用し、URL の最後に **/api/messages** を追加します。\n\n    ![アプリ URI](~/assets/images/sbs-messagingextension-action/appuri.png)\n\n1. **[適用]** を選択します。\n\n    Azure Bot Serviceでボットが正常に設定されました。\n"
- title: Azure AD アプリの登録を更新する
  durationInMinutes: 1
  content: "1. [Azure portal](https://portal.azure.com/) にアクセスします。\n\n1. **Azure Active Directory** を選択します。\n\n1. 左側のナビゲーション パネルで、[ **アプリの登録**] を選択します。\n\n1. ボットを選択します。\n\n   ![アプリの登録](~/assets/images/sbs-messagingextension-action/app.-registerations.png)\n\n1. [**管理**] で [**API の公開**] を選択します。\n\n1. [ **設定**] を選択します。\n\n   ![API を公開する](~/assets/images/sbs-messagingextension-action/set-exposeanapi.png)\n\n1. **アプリケーション ID URI を** 次の`api://{AppID}`形式で設定します。\n\n   ![リンクを設定する](~/assets/images/sbs-messagingextension-action/set-link.png)\n\n1. の間`api://`に値を`WebAppDomain`挿入します`/{AppID}`。</br>\n    `api://2bb1****.ngrok.io/{AppID}`</br>\n    \n   次の図は、ドメイン名を示しています。\n    \n    ![公開](~/assets/images/sbs-messagingextension-action/exposeanapi.png)\n\n    > [!NOTE]\n    > ngrok などのトンネリング サービスを使用している場合は、ngrok サブドメインが変更されるたびに値を更新してください。\n    > `For example: api://f631****.ngrok.io/92c11075-c629-4a1e-ab58-02b4fd4204c2`は、新しい ngrok サブドメイン名です `f631****.ngrok.io` 。\n\n1. **[スコープの追加]** を選択します。 \n\n   ![スコープを選択する](~/assets/images/sbs-messagingextension-action/addascope.png)\n\n1. 表示されるパネルで、**スコープ名** として入力`access_as_user`します。\n\n1. **同意できるWho** を設定しますか`Admins and users`?\n\n1. スコープの適切な値を使用して管理者とユーザーの同意プロンプトを `access_as_user` 構成するには、フィールドに次の情報を入力します。</br>\n\n     * **管理者の同意表示名** として入力`Teams can access the user’s profile`します。\n\n     * **管理者の同意の説明** として入力`Allows Teams to call the app’s web APIs as the current user`します。\n\n     * **ユーザー同意表示名** として入力`Teams can access the user profile and make requests on the user’s behalf`します。\n\n     * **ユーザーの同意の説明** として入力`Enable Teams to call this app’s APIs with the same rights as the user`します。\n\n1. **[状態]** が **[有効]** に設定されていることを確認してください。\n\n1. [保存 **するスコープの追加]** を選択します。\n\n    ![スコープを追加する](~/assets/images/sbs-messagingextension-action/addascopeuser.png)\n\n    > [!NOTE]\n    > **スコープ名** は、最後に追加された **アプリケーション ID** URI と`/access_as_user`一致する必要があります。</br>\n       `api://2bb1****.ngrok.io/00000000-0000-0000-0000-000000000000/access_as_user`\n\n    ![Scopes](~/assets/images/sbs-messagingextension-action/scopes.png) \n\n1. **[承認済みのクライアント アプリケーション]** セクションで、アプリの Web アプリケーションに対して承認するアプリケーションを特定します。 \n\n1. **[クライアント アプリケーションの追加]** を選択します。 \n\n    ![クライアント アプリケーションを選択する](~/assets/images/sbs-messagingextension-action/clientapps.png) \n\n1. モバイルアプリケーションまたはデスクトップ アプリケーションTeams **クライアント ID を**`1fec8e78-bce4-4aaf-ab1b-5451cc387264`入力します。 \n\n    ![クライアント アプリケーションを追加する 1](~/assets/images/sbs-messagingextension-action/addclientapplication1.png) \n\n   **クライアント ID:**`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` Teams Web アプリケーションに対して入力できます。\n\n    ![クライアント アプリケーションの追加 2](~/assets/images/sbs-messagingextension-action/addclientapplication2.png) \n\n1. [ **承認されたスコープ]** を選択します。\n\n    ![クライアント アプリケーションの追加 2](~/assets/images/sbs-messagingextension-action/authorizedscope.png) \n\n   次の図は、クライアント ID を表示します。\n\n    ![クライアント アプリケーション](~/assets/images/sbs-messagingextension-action/clientapp.png) \n\n1. 左側のパネルで、[ **API アクセス許可**] を選択します。 \n\n   > [!NOTE]\n   > ユーザーは、Azure AD アプリが別のテナントに登録されている場合にのみ、これらのアクセス許可に同意する必要があります。\n\n1. [**アクセス許可を追加**] を選択します。\n\n    ![アクセス許可を追加する](~/assets/images/sbs-messagingextension-action/addpermission.png)\n\n1. **Microsoft Graph** を選択します。\n\n1. [**委任されたアクセス許可**] を選択します。\n\n1. 以下のアクセス許可を追加します。</br>\n     * **email**\n     * **offline_access**\n     * **OpenId**\n     * **profile**\n     * **User.Read**\n\n1. **[アクセス許可の追加]** を選択します。\n\n     ![その他のアクセス許可](~/assets/images/sbs-messagingextension-action/other-permissions.png)\n\n1. 左側のパネルで [ **認証** ] を選択してリダイレクト URI を設定します。 \n\n   > [!NOTE]\n   > アプリに IT 管理者の同意が付与されていない場合、ユーザーはアプリを初めて使用する際に同意を提供する必要があります。\n           \n     1. **[プラットフォームの追加]** を選択します。\n     1. **[Web]** を選びます。\n\n        ![Web](~/assets/images/sbs-messagingextension-action/web.png)\n\n     1. 完全修飾ドメイン名に追加して、アプリの `auth-end` リダイレクト URI を入力します。</br> \n       `https://2bb1****.ngrok.io/auth-end`. </br>\n\n     1. 次のチェック ボックスをオンにして **、暗黙的な許可フローとハイブリッド フロー** を有効にします。\n         * **ID トークン**\n         * **アクセス トークン**\n\n     1. **[構成]** を選択します。\n\n        ![Auth-end](~/assets/images/sbs-messagingextension-action/authend.png)\n"
- title: アプリの設定とマニフェスト ファイルを設定する
  durationInMinutes: 1
  content: "1. 複製されたリポジトリで **appsettings.json** に移動します。\n\n    ![アプリ設定の場所](~/assets/images/sbs-messagingextension-action/appsettingslocation.png)\n\n1. 最新バージョンのVisual Studioで **appsettings.json** を開き、次の情報を更新します。  \n\n     * **MultiTenant** に設定`\"MicrosoftAppType\"`します。\n     * ボットの **Microsoft アプリ ID に** 設定`\"MicrosoftAppId\"`します。\n     * ボットの **クライアント シークレット ID** **の値** に設定`\"MicrosoftAppPassword\"`します。\n     * MultiTenant ボットの場合は空白のままにします `\"MicrosoftAppTenantId\"` 。\n     * 完全修飾ドメイン名に設定 `\"BaseUrl\"` します。\n\n    ![アプリの設定](~/assets/images/sbs-messagingextension-action/json-file.png)\n\n1. 複製されたリポジトリ内に `manifest.json` 移動します。\n\n    ![マニフェスト ファイルの場所](~/assets/images/sbs-messagingextension-action/manifestlocation.png)\n\n1. 最新バージョンのVisual Studioで開`manifest.json`き、次の変更を行います。\n\n     * 完全修飾ドメイン名に `<<validDomains>>` 置き換えます。\n     * すべての出現箇所をボットの `<<Microsoft-App-ID>>` **Microsoft アプリ ID に** 置き換えます。\n\n    ![マニフェスト イメージ 2](~/assets/images/sbs-messagingextension-action/botid1.png)\n"
- title: サービスをビルドして実行する
  durationInMinutes: 1
  content: "**最新バージョンのVisual Studioまたはコマンド ラインを使用してサービスをビルドして実行するには**\n\n# <a name=\"latest-version-of-visual-studio\"></a>[Visual Studioの最新バージョン](#tab/latestversionofvisualstudio)\n\n   1. 最新バージョンのVisual Studioを起動します。\n   1. **FileOpen** >  >  **Project/Solution** に移動します。\n\n      ![ファイルを開く](~/assets/images/sbs-messagingextension-action/VSopenfile.png)\n\n   1. **フォルダーから TeamsMessagingExtensionsAction.csproj** ファイル **csharp_dotnet** 選択します。\n\n      ![ソリューション ファイル](~/assets/images/sbs-messagingextension-action/openproject.png)\n\n   1. **F5** キーを押してプロジェクトを実行します。\n\n   1. 以下のダイアログが表示されたら、**[はい]** を選択します:\n\n      ![証明書を信頼する](~/assets/images/sbs-messagingextension-action/certificate.png)\n\n      Web ページが開き、メッセージが表示されます **。ボットの準備は完了です。**\n\n      ![アプリの準備完了](~/assets/images/sbs-messagingextension-action/appisready.png) \n\n    \n# <a name=\"command-line\"></a>[コマンド ライン](#tab/cli)\n\nコマンド プロンプト ウィンドウ **で 51.teams-messaging-extensions-action > csharp_dotnetcore >サンプル** に移動し、次のコマンドを入力します。\n\n```bash\ndotnet run\n```\n\n![Dotnet](~/assets/images/sbs-messagingextension-action/dotnetruncmd.png)\n  \n"
- title: アクション メッセージング拡張機能アプリをTeamsに追加する
  durationInMinutes: 1
  content: "1. 複製されたリポジトリで、 **csharp_dotnetcore > 51.teams-messaging-extensions-action > TeamsAppManifest** に移動します。\n\n1. **マニフェスト** フォルダーに存在する次のファイルを含む.zipを作成します。 \n   * manifest.json\n   * icon-outline.png\n   * icon-color.png\n\n   ![Zip ファイル](~/assets/images/sbs-messagingextension-action/zipfile.png) \n\n1. Microsoft Teamsに移動 **します**。\n\n1. **[アプリ]** を選択します。\n\n1. [ **アプリの管理**] を選択します。\n\n1. **[カスタム アプリをアップロードする]** を選択します。\n\n   ![アップロード](~/assets/images/sbs-messagingextension-action/uploadacustomapp1.png)\n\n1. **[開く]** を選択して、**マニフェスト** フォルダーに作成した.zip ファイルをアップロードします。\n\n   ![zip ファイルを選択する](~/assets/images/sbs-messagingextension-action/openzipfile.png)\n\n1. **[追加]** を選択します。\n\n   ![アプリを追加する](~/assets/images/sbs-messagingextension-action/add.png)\n\n                \n"
- title: Teamsでアプリを操作する
  durationInMinutes: 1
  content: "1. 作成ボックスのコマンド リストから [ **カードの作成** ] コマンドを選択します。\n\n   ![カード](~/assets/images/sbs-messagingextension-action/create-card.png)\n\n1. モーダル ポップアップに情報を入力します。\n\n   ![情報](~/assets/images/sbs-messagingextension-action/output-card.png)\n\n1. **[送信]** を選択します。\n\n   ![submit](~/assets/images/sbs-messagingextension-action/submit.png)\n\n1. オーバーフロー メニューから (...) を選択します。\n   \n1. **[その他のアクション]** に移動します。\n\n1. [ **メッセージの共有] を選択します**。\n\n   ![カードを共有する](~/assets/images/sbs-messagingextension-action/sharemessage.png)\n\n1. 画像を含め、送信する必要がある場合は、チェック ボックスをオンにします。\n\n   ![出力](~/assets/images/sbs-messagingextension-action/sharemessageoutput.png)\n"
- title: チャレンジを完了する
  durationInMinutes: 1
  content: >
    このようなことを思い付いたのですか?

       ![出力](~/assets/images/sbs-messagingextension-action/sharemessageoutput1.png)
- content: '**アクション メッセージング拡張機能** アプリの使用を開始するためのチュートリアルを完了しました。'
