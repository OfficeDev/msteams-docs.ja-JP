---
title: タブの認証フロー
description: タブの認証フローについて説明する
ms.topic: conceptual
localization_priority: Normal
keywords: teams 認証フロー タブ
ms.openlocfilehash: 012e38b0fa689527999237ccc07b7352fc00ae71
ms.sourcegitcommit: 825abed2f8784d2bab7407ba7a4455ae17bbd28f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/26/2021
ms.locfileid: "52020395"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="68bcd-104">タブの Microsoft Teams 認証フロー</span><span class="sxs-lookup"><span data-stu-id="68bcd-104">Microsoft Teams authentication flow for tabs</span></span>

> [!NOTE]
> <span data-ttu-id="68bcd-105">モバイル クライアントでタブで認証を機能するには、少なくとも 1.4.1 バージョンの Microsoft Teams JavaScript SDK を使用している必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-105">For authentication to work for your tab on mobile clients, you must ensure you are using at least 1.4.1 version of the Microsoft Teams JavaScript SDK.</span></span>
> <span data-ttu-id="68bcd-106">Teams SDK は、認証フロー用に個別のウィンドウを起動します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-106">Teams SDK launches separate window for authentication flow.</span></span> <span data-ttu-id="68bcd-107">属性を `SameSite` **Lax に設定します**。</span><span class="sxs-lookup"><span data-stu-id="68bcd-107">Set the `SameSite` attribute to **Lax**.</span></span> <span data-ttu-id="68bcd-108">Teams デスクトップ クライアントまたは以前のバージョンの Chrome または Safari は `SameSite` =None をサポートしていない。</span><span class="sxs-lookup"><span data-stu-id="68bcd-108">Teams desktop client or older versions of Chrome or Safari do not support `SameSite`=None.</span></span>

<span data-ttu-id="68bcd-109">OAuth 2.0 は、Azure Active Directory (AAD) および他の多くの ID プロバイダーによって使用される認証と承認のオープン標準です。</span><span class="sxs-lookup"><span data-stu-id="68bcd-109">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (AAD) and many other identity providers.</span></span> <span data-ttu-id="68bcd-110">OAuth 2.0 の基本的な理解は、Teams での認証を操作する前提条件です。</span><span class="sxs-lookup"><span data-stu-id="68bcd-110">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams.</span></span> <span data-ttu-id="68bcd-111">詳細については、「正式な仕様よりも簡単に実行できる [OAuth 2](https://aaronparecki.com/oauth-2-simplified/) 簡略化」 [を参照してください](https://oauth.net/2/)。</span><span class="sxs-lookup"><span data-stu-id="68bcd-111">For more information, see [OAuth 2 simplified](https://aaronparecki.com/oauth-2-simplified/) that is easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="68bcd-112">タブとボットの認証フローは異なります。タブは Web サイトに似ているため、OAuth 2.0 を直接使用できます。</span><span class="sxs-lookup"><span data-stu-id="68bcd-112">Authentication flow for tabs and bots are different because tabs are similar to websites so they can use OAuth 2.0 directly.</span></span> <span data-ttu-id="68bcd-113">ボットの動作はいくつかの方法が異なりますが、コア概念は同じです。</span><span class="sxs-lookup"><span data-stu-id="68bcd-113">Bots do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="68bcd-114">Node と [OAuth 2.0](https://oauth.net/2/grant-types/implicit/)暗黙的付与の種類を使用するタブとボットの認証フローの例については、「タブの認証フローを開始する」 [を参照してください](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow)。</span><span class="sxs-lookup"><span data-stu-id="68bcd-114">For an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/), see [initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span></span>

> [!NOTE]
> <span data-ttu-id="68bcd-115">ユーザーにログイン ボタン **を** 表示し、ボタンの選択に応じて API を呼び出す前に、SDK の初期化が完了するのを `microsoftTeams.authentication.authenticate` 待つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-115">Before showing a **Login** button to the user and calling the `microsoftTeams.authentication.authenticate` API in response to selecting the button, you must wait for the SDK initialization to complete.</span></span> <span data-ttu-id="68bcd-116">初期化が完了すると呼び `microsoftTeams.initialize` 出される API にコールバックを渡します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-116">You can pass a callback to the `microsoftTeams.initialize` API that is called when initialization completes.</span></span>

![タブ認証シーケンス図](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="68bcd-118">ユーザーは、タブ構成またはコンテンツ ページのコンテンツ (通常は [サインイン] または [ログイン] ボタン)**を操作** します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-118">The user interacts with the content on the tab configuration or content page, commonly a **Sign in** or **Log in** button.</span></span>
2. <span data-ttu-id="68bcd-119">タブは、認証開始ページの URL を作成します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-119">The tab constructs the URL for its auth start page.</span></span> <span data-ttu-id="68bcd-120">必要に応じて、URL プレースホルダーの情報を使用するか、Teams クライアント SDK メソッドを呼び出して、ユーザーの認証 `microsoftTeams.getContext()` エクスペリエンスを合理化します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-120">Optionally, it uses information from URL placeholders or calls `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="68bcd-121">たとえば、AAD を使用して認証する場合、パラメーターがユーザーの電子メール アドレスに設定されている場合、ユーザーが最近サインインした場合、ユーザーはサインイン `login_hint` する必要が生じなきます。</span><span class="sxs-lookup"><span data-stu-id="68bcd-121">For example, when authenticating with AAD, if the `login_hint` parameter is set to the user's email address, the user does not have to sign in if they have done so recently.</span></span> <span data-ttu-id="68bcd-122">これは、AAD がユーザーのキャッシュされた資格情報を使用する理由です。</span><span class="sxs-lookup"><span data-stu-id="68bcd-122">This is because AAD uses the user's cached credentials.</span></span> <span data-ttu-id="68bcd-123">ポップアップ ウィンドウが簡単に表示され、表示されなくなります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-123">The pop-up window is shown briefly and then disappears.</span></span>
3. <span data-ttu-id="68bcd-124">次に、タブは `microsoftTeams.authentication.authenticate()` メソッドを呼び出し、`successCallback` 関数と `failureCallback` 関数を登録します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-124">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="68bcd-125">Teams は、ポップアップ ウィンドウで iframe でスタート ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="68bcd-125">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="68bcd-126">スタート ページは、ランダム なデータを生成し、将来の検証のために保存し、Azure プロバイダーのエンドポイントなどの ID プロバイダーのエンドポイント `state` `/authorize` `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` にリダイレクトAD。</span><span class="sxs-lookup"><span data-stu-id="68bcd-126">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint, such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="68bcd-127">`<tenant id>`context.tid である独自のテナント ID に置き換える。</span><span class="sxs-lookup"><span data-stu-id="68bcd-127">Replace `<tenant id>` with your own tenant id that is context.tid.</span></span>
<span data-ttu-id="68bcd-128">Teams の他のアプリケーション認証フローと同様に、スタート ページはリスト内のドメインと、リダイレクト ページのポスト サインインと同じドメイン上にある `validDomains` 必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-128">Similar to other application auth flows in Teams, the start page must be on a domain that is in its `validDomains` list, and on the same domain as the post sign in redirect page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="68bcd-129">OAuth 2.0 暗黙的な付与フローでは、認証要求内のパラメーターが呼び出されます。これは、クロスサイト要求フォージェリ攻撃を防ぐための一意のセッション データを `state` [含む。](https://en.wikipedia.org/wiki/Cross-site_request_forgery)</span><span class="sxs-lookup"><span data-stu-id="68bcd-129">The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request, which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="68bcd-130">この例では、データにランダムに生成された GUID を使用 `state` します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-130">The examples use a randomly-generated GUID for the `state` data.</span></span>

5. <span data-ttu-id="68bcd-131">プロバイダーのサイトで、ユーザーはサインインし、タブへのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-131">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="68bcd-132">プロバイダーは、ユーザーをアクセス トークンを使用してタブの OAuth 2.0 リダイレクト ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-132">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="68bcd-133">タブは、返された値が以前に保存された値と一致することを確認し、手順 3 で登録された関数を呼び出 `state` `microsoftTeams.authentication.notifySuccess()` `successCallback` します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-133">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="68bcd-134">Teams はポップアップ ウィンドウを閉じます。</span><span class="sxs-lookup"><span data-stu-id="68bcd-134">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="68bcd-135">タブは、ユーザーの開始場所に応じて、構成 UI を表示するか、タブの内容を更新または再読み込みします。</span><span class="sxs-lookup"><span data-stu-id="68bcd-135">The tab either displays configuration UI, refreshes, or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="68bcd-136">タブ コンテキストをヒントとして扱う</span><span class="sxs-lookup"><span data-stu-id="68bcd-136">Treat tab context as hints</span></span>

<span data-ttu-id="68bcd-137">タブ コンテキストはユーザーに関する有用な情報を提供しますが、この情報を使用してユーザーを認証することはできません。</span><span class="sxs-lookup"><span data-stu-id="68bcd-137">Although the tab context provides helpful information regarding the user, do not use this information to authenticate the user.</span></span> <span data-ttu-id="68bcd-138">タブ コンテンツの URL に URL パラメーターとして情報を取得した場合や、Microsoft Teams クライアント SDK で関数を呼び出した場合でも、ユーザー `microsoftTeams.getContext()` を認証します。</span><span class="sxs-lookup"><span data-stu-id="68bcd-138">Do authenticate the user even if you get the information as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="68bcd-139">悪意のあるアクターは、独自のパラメーターを使用してタブ コンテンツ URL を呼び出す可能性があります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-139">A malicious actor can invoke your tab content URL with its own parameters.</span></span> <span data-ttu-id="68bcd-140">アクターは、Microsoft Teams を偽装する Web ページを呼び出して、タブ コンテンツ URL を iframe に読み込み、独自のデータを関数に返 `getContext()` することもできます。</span><span class="sxs-lookup"><span data-stu-id="68bcd-140">The actor can also invoke a web page impersonating Microsoft Teams to load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="68bcd-141">使用する前に、タブ コンテキスト内の ID 関連情報をヒントとして扱い、検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bcd-141">You must treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="68bcd-142">ポップアップ ページから認証 [ページに移動するノートを参照してください](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)。</span><span class="sxs-lookup"><span data-stu-id="68bcd-142">Refer to the notes in [navigate to the authorization page from your pop-up page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="code-sample"></a><span data-ttu-id="68bcd-143">コード サンプル</span><span class="sxs-lookup"><span data-stu-id="68bcd-143">Code sample</span></span>

<span data-ttu-id="68bcd-144">タブ認証プロセスを示すサンプル コード。</span><span class="sxs-lookup"><span data-stu-id="68bcd-144">Sample code showing the tab authentication process.</span></span>

| <span data-ttu-id="68bcd-145">**サンプル名**</span><span class="sxs-lookup"><span data-stu-id="68bcd-145">**Sample name**</span></span> | <span data-ttu-id="68bcd-146">**説明**</span><span class="sxs-lookup"><span data-stu-id="68bcd-146">**Description**</span></span> | <span data-ttu-id="68bcd-147">**C#**</span><span class="sxs-lookup"><span data-stu-id="68bcd-147">**C#**</span></span> | <span data-ttu-id="68bcd-148">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="68bcd-148">**Node.js**</span></span> |
|-----------------|-----------------|-------------|------------|
| <span data-ttu-id="68bcd-149">Teams タブ認証</span><span class="sxs-lookup"><span data-stu-id="68bcd-149">Teams tab authentication</span></span> | <span data-ttu-id="68bcd-150">AAD を使用したタブの認証プロセス。</span><span class="sxs-lookup"><span data-stu-id="68bcd-150">Authentication process for tabs using AAD.</span></span> | [<span data-ttu-id="68bcd-151">View</span><span class="sxs-lookup"><span data-stu-id="68bcd-151">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [<span data-ttu-id="68bcd-152">View</span><span class="sxs-lookup"><span data-stu-id="68bcd-152">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a><span data-ttu-id="68bcd-153">詳細情報</span><span class="sxs-lookup"><span data-stu-id="68bcd-153">More details</span></span>

<span data-ttu-id="68bcd-154">AAD を使用したタブ認証の詳細な実装については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="68bcd-154">For a detailed implementation for tab authentication using AAD, see:</span></span>

* [<span data-ttu-id="68bcd-155">Teams タブでユーザーを認証する</span><span class="sxs-lookup"><span data-stu-id="68bcd-155">Authenticate a user in a Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="68bcd-156">サイレント認証</span><span class="sxs-lookup"><span data-stu-id="68bcd-156">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
