---
title: タブの認証フロー
description: タブの認証フローについて説明します
ms.topic: conceptual
keywords: Teams の認証フロー タブ
ms.openlocfilehash: 9505419a6594529bcf8d19a90d029705e573c67b
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014587"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="adcf9-104">タブの Microsoft Teams 認証フロー</span><span class="sxs-lookup"><span data-stu-id="adcf9-104">Microsoft Teams authentication flow for tabs</span></span>

> [!Note]
> <span data-ttu-id="adcf9-105">モバイル クライアントのタブで認証を機能するには、Teams JavaScript SDK の 1.4.1 バージョン以上を使用している必要があります。</span><span class="sxs-lookup"><span data-stu-id="adcf9-105">For authentication to work for your tab on mobile clients, you need to ensure you're using at least the 1.4.1 version of the Teams JavaScript SDK.</span></span>
> <span data-ttu-id="adcf9-106">Teams SDK は認証フロー用に個別のウィンドウを起動するため、samesite 属性を 'Lax' に設定できます。</span><span class="sxs-lookup"><span data-stu-id="adcf9-106">Teams SDK launches separate window for authentication flow and hence samesite attribute can be set to 'Lax'.</span></span> <span data-ttu-id="adcf9-107">現在、SameSite=None は Teams デスクトップ クライアントまたは Chrome または Safari の以前のバージョンではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="adcf9-107">Currently, SameSite=None is not supported by the Teams desktop client or older versions of Chrome or Safari.</span></span>

<span data-ttu-id="adcf9-108">OAuth 2.0 は、Azure AD および他の多くの ID プロバイダーで使用される認証と承認のオープン標準です。</span><span class="sxs-lookup"><span data-stu-id="adcf9-108">OAuth 2.0 is an open standard for authentication and authorization used by Azure AD and many other identity providers.</span></span> <span data-ttu-id="adcf9-109">OAuth 2.0 の基本的な理解は、Teams で認証を操作する場合の前提条件です。 [ここでは、正式な仕様よりも](https://aaronparecki.com/oauth-2-simplified/) 簡単に従える優れた概要 [を示します](https://oauth.net/2/)。</span><span class="sxs-lookup"><span data-stu-id="adcf9-109">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="adcf9-110">タブとボットの認証フローは少し異なります。タブは Web サイトに非常に似ているため、OAuth 2.0 を直接使用できます。bots are not and must do a few things differently, but the core concepts are identical.</span><span class="sxs-lookup"><span data-stu-id="adcf9-110">Authentication flow for tabs and bots are a little different because tabs are very similar to websites so they can use OAuth 2.0 directly; bots are not and must do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="adcf9-111">*「Node*[と](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) [OAuth 2.0](https://oauth.net/2/grant-types/implicit/)の暗黙的な許可の種類を使用して、タブとボットの認証フローの例については、タブの認証フローを開始する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="adcf9-111">*See*, [Initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) for an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/).</span></span>

![タブ認証シーケンス図](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="adcf9-113">ユーザーは、タブ構成またはコンテンツ ページのコンテンツを操作します。通常、"サインイン" または "ログイン" というラベルの付いたボタンです。</span><span class="sxs-lookup"><span data-stu-id="adcf9-113">The user interacts with the content on the tab configuration or content page, commonly a button labeled "Sign in" or "Log in".</span></span>
2. <span data-ttu-id="adcf9-114">タブは、認証開始ページの URL を作成します。必要に応じて、URL プレースホルダーの情報を使用するか、Teams クライアント SDK メソッドを呼び出して、ユーザーの認証エクスペリエンスを `microsoftTeams.getContext()` 合理化します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-114">The tab constructs the URL for its auth start page, optionally using information from URL placeholders or by calling `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="adcf9-115">たとえば、Azure AD で認証を行う場合、パラメーターがユーザーの電子メール アドレスに設定されている場合、Azure AD はユーザーのキャッシュされた資格情報を可能な限り使用します。ポップアップが短時間点滅して消えるので、ユーザーが最近サインインした場合でも、ユーザーはサインインする必要がなくなる可能性があります。 `login_hint`</span><span class="sxs-lookup"><span data-stu-id="adcf9-115">For example, when authenticating with Azure AD, if the `login_hint` parameter is set to the user's email address, the user may not even have to sign in if they have done so recently, because Azure AD will use the user's cached credentials if possible: the popup will flash briefly and then disappear.</span></span>
3. <span data-ttu-id="adcf9-116">次に、タブは `microsoftTeams.authentication.authenticate()` メソッドを呼び出し、`successCallback` 関数と `failureCallback` 関数を登録します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-116">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="adcf9-117">Teams は、ポップアップ ウィンドウの iframe でスタート ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="adcf9-117">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="adcf9-118">開始ページは、ランダムなデータを生成し、将来の検証のために保存し、Azure AD などの ID プロバイダーの `state` `/authorize` `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` エンドポイントにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="adcf9-118">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="adcf9-119">独自 `<tenant id>` のテナント ID (context.tid) に置き換えてください。</span><span class="sxs-lookup"><span data-stu-id="adcf9-119">Replace `<tenant id>` with your own tenant id (context.tid).</span></span>
    * <span data-ttu-id="adcf9-120">Teams の他のアプリケーション認証フローと同様に、スタート ページは、そのリスト内のドメインと、ログイン後のリダイレクト ページと同じドメイン上にある `validDomains` 必要があります。</span><span class="sxs-lookup"><span data-stu-id="adcf9-120">Like other application auth flows in Teams, the start page must be on a domain that's in its `validDomains` list, and on the same domain as the post-login redirect page.</span></span>
    * <span data-ttu-id="adcf9-121">**重要**: OAuth 2.0 の暗黙的な許可フローは、クロスサイト要求フォージェリ攻撃を防ぐために、一意のセッション データを含む認証要求のパラメーターを呼び出 `state` [します](https://en.wikipedia.org/wiki/Cross-site_request_forgery)。</span><span class="sxs-lookup"><span data-stu-id="adcf9-121">**IMPORTANT**: The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="adcf9-122">次の例では、データにランダムに生成された GUID を使用 `state` します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-122">The examples below use a randomly-generated GUID for the `state` data.</span></span>
5. <span data-ttu-id="adcf9-123">プロバイダーのサイトで、ユーザーはサインインし、タブへのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-123">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="adcf9-124">プロバイダーは、アクセス トークンを使用してユーザーをタブの OAuth 2.0 リダイレクト ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-124">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="adcf9-125">タブは、戻り値が以前に保存された値と一致することを確認し、呼び出しは手順 3 で登録された関数を呼び出 `state` `microsoftTeams.authentication.notifySuccess()` `successCallback` します。</span><span class="sxs-lookup"><span data-stu-id="adcf9-125">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="adcf9-126">Teams がポップアップ ウィンドウを閉じます。</span><span class="sxs-lookup"><span data-stu-id="adcf9-126">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="adcf9-127">タブは、ユーザーの開始場所に応じて、構成 UI を表示するか、タブのコンテンツを更新または再読み込みします。</span><span class="sxs-lookup"><span data-stu-id="adcf9-127">The tab either displays configuration UI or refreshes or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="adcf9-128">タブ コンテキストをヒントとして扱う</span><span class="sxs-lookup"><span data-stu-id="adcf9-128">Treat tab context as hints</span></span>

<span data-ttu-id="adcf9-129">タブ コンテキストはユーザーに関する有用な情報を提供しますが、タブ コンテンツの URL への URL パラメーターとして取得するか、Microsoft Teams クライアント SDK の関数を呼び出す場合でも、この情報を使用してユーザーを認証しません。 `microsoftTeams.getContext()`</span><span class="sxs-lookup"><span data-stu-id="adcf9-129">Although the tab context provides helpful information regarding the user, don't use this information to authenticate the user whether you get it as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="adcf9-130">悪意のあるアクターが独自のパラメーターを使用してタブ コンテンツの URL を呼び出す可能性があります。また、Microsoft Teams を偽装する Web ページが iframe にタブ コンテンツ URL を読み込み、独自のデータを関数に返す可能性があります。 `getContext()`</span><span class="sxs-lookup"><span data-stu-id="adcf9-130">A malicious actor could invoke your tab content URL with its own parameters, and a web page impersonating Microsoft Teams could load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="adcf9-131">タブ コンテキストでは、ID 関連の情報をヒントとして扱い、使用する前に検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="adcf9-131">You should treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="adcf9-132">ポップアップ ページから承認ページに [移動するのメモを参照してください](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)。</span><span class="sxs-lookup"><span data-stu-id="adcf9-132">Refer to the notes in [Navigate to the authorization page from your popup page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="samples"></a><span data-ttu-id="adcf9-133">サンプル</span><span class="sxs-lookup"><span data-stu-id="adcf9-133">Samples</span></span>

<span data-ttu-id="adcf9-134">タブ認証プロセスを示すサンプル コードについては、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="adcf9-134">For sample code showing the tab authentication process see:</span></span>

* [<span data-ttu-id="adcf9-135">Microsoft Teams タブ認証のサンプル (ノード)</span><span class="sxs-lookup"><span data-stu-id="adcf9-135">Microsoft Teams tab authentication sample (Node)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [<span data-ttu-id="adcf9-136">Microsoft Teams タブ認証のサンプル (C#)</span><span class="sxs-lookup"><span data-stu-id="adcf9-136">Microsoft Teams tab authentication sample (C#)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a><span data-ttu-id="adcf9-137">詳細情報</span><span class="sxs-lookup"><span data-stu-id="adcf9-137">More details</span></span>

<span data-ttu-id="adcf9-138">Azure Active Directory をターゲットとするタブ認証の詳細な実装チュートリアルについては、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="adcf9-138">For a detailed implementation walkthrough for tab authentication targeting Azure Active Directory see:</span></span>

* [<span data-ttu-id="adcf9-139">Microsoft Teams タブでユーザーを認証する</span><span class="sxs-lookup"><span data-stu-id="adcf9-139">Authenticate a user in a Microsoft Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="adcf9-140">サイレント認証</span><span class="sxs-lookup"><span data-stu-id="adcf9-140">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
