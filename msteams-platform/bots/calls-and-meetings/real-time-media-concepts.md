---
title: Microsoft Teams を使用したリアルタイムメディア通話とオンライン会議
description: リアルタイムの音声通話とビデオ通話、オンライン会議を実行できる bot の主要な概念について説明します。
keywords: 音声ストリームのビデオストリーム音声/ビデオ通話のリアルタイムメディアアプリケーション-ホストされているメディアサービスでホストされるメディア
ms.openlocfilehash: 0ec99d1caa8810d292170c7c70a1518de7301873
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/01/2020
ms.locfileid: "41674787"
---
# <a name="real-time-media-calls-and-meetings-with-microsoft-teams"></a>Microsoft Teams でのリアルタイムメディア通話と会議

リアルタイムメディアプラットフォームを使用すると、bot がリアルタイムの音声、ビデオ、画面共有を使用して Microsoft Teams の通話と会議を操作することができます。 これは、ボットが、*フレームごと*に音声およびビデオコンテンツフレームを送受信できる高度な機能です。 Bot は、音声、ビデオ、画面共有メディアストリームへの "生の" アクセス権を持っています。 (すべてのメディア処理に対してリアルタイムメディアプラットフォームを使用する_サービスホスト型メディア_の簡単なものではなく、_アプリケーションに_よってホストされているメディアの bot と呼ばれる)。

たとえば、bot による1:1 呼び出しでは、ユーザーが話すときに、bot は20ミリ秒 (ms) のオーディオを含む各フレームを使用して、1秒間に50オーディオフレームを受信します。 アプリケーションによってホストされているメディアボットは、ユーザーが読み上げを停止した後に録音を待つことなく、オーディオフレームの受信時にリアルタイムの音声認識を実行できます。 Bot は、ビデオベースの画面共有コンテンツを含む高解像度のビデオを送受信することもできます。

このプラットフォームは、bot がメディアを送受信するための簡単なソケットに似た API を提供し、ビデオの SILK (や g.722 などのコーデックを使用した音声/ビデオパケットのリアルタイムでのエンコードとデコードを処理します。 また、このプラットフォームは、すべてのメディアパケットの暗号化/暗号化解除とパケットネットワーク転送を自動的に処理するので、この bot は、実際の音声/ビデオコンテンツについてのみ考慮する必要があります。 リアルタイムメディアボットは、複数の参加者との会議に加えて、1:1 通話に参加できます。

この記事では、Microsoft Teams を使用してリアルタイムの音声ビデオ通話を行うボットの構築に関連する主要な概念について説明します。

## <a name="media-session"></a>メディアセッション

リアルタイムメディアボットが着信呼び出しに応答したり、Microsoft Teams 会議に参加したりする場合は、サポートする予定のモダリティを宣言する必要があります。 サポートされている各モダリティに対して、ボットは、メディアの送受信、受信のみ、または送信のみができるかどうかを宣言します。 たとえば、1:1 Teams 呼び出しを処理するように設計された bot は、オーディオの送受信を行うことができますが、ビデオを*送信*することはできません (発信者のビデオを受信する必要はありません)。 Bot と Teams の間で確立される音声およびビデオモダリティのセットは、**メディアセッション**と呼ばれます。

次の2種類のビデオモダリティがサポートされています。**メインビデオ**および**ビデオベースの画面共有**。 メインビデオは、ユーザーの webcam からビデオを転送するために使用されます。 ビデオベースの画面共有では、ユーザーは画面をビデオストリームとして共有できます。 このプラットフォームでは、ボットが*両方*のビデオタイプを送受信することができます。

Teams 会議に参加すると、ボットは複数のメインビデオストリームを同時に受信できます。メディアセッションあたり最大10個。 これにより、ボットは会議で複数の参加者を「表示」することができます。

## <a name="frames-and-frame-rate"></a>フレームとフレームレート

リアルタイムメディアボットは、メディアセッションの音声およびビデオモダリティと直接対話します。 これは、ボットが一連の**フレーム**としてメディアを送信または受信していることを意味します。各フレームは、コンテンツの単位を表します。 1秒間のオーディオは50フレームのシーケンスとして送信され、各フレームには20ミリ秒 (ms)-1/50 パーの音声コンテンツが含まれます。 1秒あたりのビデオの数は30個の静止画のシーケンスとしてスライスされており、それぞれのビデオフレームが表示される前に、33.3 ms (1/30 秒) で表示されるようになっています。 1秒あたりに送信またはレンダリングされるフレーム数は**フレームレート**と呼ばれます。 "30fps" は、1秒間に30フレームを示します。

## <a name="audio-format"></a>オーディオ形式

各音声の秒は、16000**サンプル**として表され、各サンプルには16ビットのデータが含まれています。 20ミリ秒 audio フレームには320サンプル (640 バイトのデータ) が含まれています。

## <a name="video-format"></a>ビデオの形式

ビデオでは、複数の形式がサポートされています。 ビデオ形式の2つの重要なプロパティは、**フレームのサイズ**と**色の形式**です。 サポートされているフレームサイズには、640x360 ("360p")、1280x720 ("720p")、1920x1080 ("1080p") があります。 サポートされているカラー形式には、NV12 (12 ビット/ピクセル) と RGB24 (24 ビット/ピクセル) があります。

「720p」ビデオフレームには921600ピクセル (1280 × 720) が含まれます。 RGB24 の色の書式では、各ピクセルが、赤、緑、青の各カラーコンポーネントの1バイトで構成される3バイト (24 ビット) として表されます。 そのため、1つの 720p RGB24 ビデオフレームでは2764800バイトのデータ (921600 ピクセル×3バイト/ピクセル) が必要です。 30 fps のフレームレートでは、720p RGB24 ビデオフレームを送信すると、約 80 MB/秒のコンテンツが処理されます (これは、ネットワーク転送の前に、ビデオコーデックによって大幅に圧縮されます)。

プラットフォームの高度な機能により、bot は、**エンコード**された .h フレームとしてビデオを送受信することができます。 これは、独自の RGB24 エンコーダー/デコーダーを提供するボットをサポートしているか、raw または NV12 ビットマップにデコードされたビデオストリームを必要としません。

## <a name="active-and-dominant-speakers"></a>アクティブで主要なスピーカー

複数の参加者で構成されている Teams 会議に参加する場合、bot は現在会話しているミーティング参加者を特定できます。 **アクティブなスピーカー**は、受信した各オーディオフレームでどの参加者が聞こえるかを識別します。 **主要な講演**者は、すべてのオーディオフレームで音声が聞こえない場合でも、グループ会話で現在最もアクティブな (または「優先度の高い) 参加者を特定します。 主要なスピーカーのセットは、参加者が話すことができるように変更されます。

## <a name="video-subscription"></a>ビデオ購読

1:1 通話では、ボットがビデオを受信するように設定されている場合、ボットは発信者のビデオを自動的に受け取ります。 Teams 会議では、ボットは、表示する参加者をプラットフォームに示す必要があります。 **ビデオサブスクリプション**とは、参加者のメインビデオまたは画面共有コンテンツを受信するためのボットによる要求です。 会議の参加者が会話を開催する際に、ボットは主要なスピーカーセットの更新に基づいて、目的のビデオ講読を変更することがあります。また、どの参加者が現在画面を共有しているかを示す通知があります。

## <a name="developer-resources"></a>開発者向けリソース

アプリケーションホスト型メディア bot を開発するには、Visual Studio プロジェクト内に次の NuGet パッケージをインストールする必要があります。

- [Microsoft Graph の .NET ライブラリ](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)

アプリケーションホスト型メディアのボットには、.NET/C# および Windows Server が必要です。詳細については、「[要件」および「アプリケーションホスト型メディアのボットの考慮事項](requirements-considerations-application-hosted-media-bots.md#application-hosted-media-bot-development-requires-cnet-and-windows-server)」を参照してください。
